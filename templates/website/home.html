{# templates/home.html #}
{% extends "base.html" %}
{% load static %}
{% block title %}منصة سامي لينك التقنية — وسيط سعودي موثوق{% endblock %}

{# ===== تنبيه عدم التعامل خارج المنصة (يظهر هنا فقط) ===== #}
{% block platform_notice %}
<style>
    .security-alert-wrapper {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding: 1.25rem 0;
        position: relative;
        overflow: hidden;
    }
    .security-alert-wrapper::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    }
    .security-container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 0 1.5rem;
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }
    .security-icon-box {
        width: 52px;
        height: 52px;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.2);
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ef4444;
        font-size: 1.5rem;
        flex-shrink: 0;
        box-shadow: 0 0 20px rgba(239, 68, 68, 0.1);
        animation: pulse-red 2s infinite;
    }
    @keyframes pulse-red {
        0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.2); }
        70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }
    .security-content {
        flex: 1;
    }
    .security-title {
        color: white;
        font-weight: 800;
        font-size: 1.1rem;
        margin-bottom: 0.35rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    .security-badge {
        background: #ef4444;
        color: white;
        font-size: 0.75rem;
        padding: 0.2rem 0.6rem;
        border-radius: 6px;
        font-weight: 700;
        letter-spacing: 0.5px;
    }
    .security-desc {
        color: #cbd5e1;
        font-size: 0.95rem;
        line-height: 1.6;
        margin: 0;
        max-width: 800px;
    }
    .security-close-btn {
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.1);
        color: #94a3b8;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }
    .security-close-btn:hover {
        background: rgba(255,255,255,0.15);
        color: white;
        transform: rotate(90deg);
    }
    @media (max-width: 768px) {
        .security-container {
            flex-direction: column;
            text-align: center;
            gap: 1rem;
            padding: 0 1rem;
        }
        .security-title {
            justify-content: center;
            flex-wrap: wrap;
        }
        .security-close-btn {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            width: 32px;
            height: 32px;
            font-size: 0.9rem;
        }
    }
</style>

<div class="security-alert-wrapper" id="platformSecurityNotice">
    <div class="security-container">
        <div class="security-icon-box">
            <i class="fas fa-shield-halved"></i>
        </div>
        <div class="security-content">
            <div class="security-title">
                تنبيه مهم قبل البدء
                <span class="security-badge">هام جداً</span>
            </div>
            <p class="security-desc">
                المنصّة غير مسؤولة عن أي تعاملات أو دفعات خارج سامي لينك. حفاظًا على حقوقك، أكمل الاتفاق والدفع داخل المنصّة فقط.
            </p>
        </div>
        <button class="security-close-btn" onclick="document.getElementById('platformSecurityNotice').remove()" aria-label="إغلاق">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>
{% endblock %}

{% block page_hero %}
{# قسم البطل - خارج المحتوى الرئيسي للاستفادة من التخطيط الخاص #}
<section id="hero" class="hero-section">
  <div class="container">
    <div class="hero-content fade-in">
      <div class="hero-text">
        <div class="hero-badge">
          <i class="fas fa-shield-alt text-primary me-2"></i>
          <span>وسيط سعودي منظم</span>
        </div>

        <h1 class="hero-title">
          إدارة <span>احترافية</span> لدورة عملك من أول طلب حتى آخر فاتورة
        </h1>

        <p class="hero-description">
          منصة سامي لينك وسيط سعودي ١٠٠٪ ينظم العلاقة بين العملاء والتقنيين بدورة عمل واضحة،
          فواتير نظامية، وحماية مالية للطرفين بما يتوافق مع الأنظمة السعودية.
        </p>

        <div class="hero-features">
          <div class="hero-feature">
            <div class="hero-feature-icon"><i class="fas fa-check-circle"></i></div>
            <div class="hero-feature-text">إخفاء بيانات العميل أثناء مرحلة العروض لرفع مستوى الأمان والخصوصية</div>
          </div>
          <div class="hero-feature">
            <div class="hero-feature-icon"><i class="fas fa-check-circle"></i></div>
            <div class="hero-feature-text">مسار مالي منظم مع فواتير نظامية ورسوم وضريبة محددة بوضوح</div>
          </div>
          <div class="hero-feature">
            <div class="hero-feature-icon"><i class="fas fa-check-circle"></i></div>
            <div class="hero-feature-text">تقنيون سعوديون تم التحقق من هوياتهم وخبراتهم قبل الانضمام للمنصة</div>
          </div>
        </div>

        <div class="hero-actions">
          <a href="{% url 'marketplace:request_create' %}" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i> اطلب خدمة
          </a>

          {% if user.is_authenticated %}
            {% if user.role == 'client' %}
              <a href="{% url 'marketplace:my_requests' %}" class="btn btn-secondary">
                <i class="fas fa-clipboard-list me-2"></i> إدارة طلباتي
              </a>
            {% elif user.role == 'employee' or user.role == 'tech' %}
              <a href="{% url 'marketplace:my_tasks' %}" class="btn btn-secondary">
                <i class="fas fa-tools me-2"></i> عرض مهامي
              </a>
            {% else %}
              <a href="{% url 'dashboard:admin_dashboard' %}" class="btn btn-secondary">
                <i class="fas fa-chart-pie me-2"></i> الانتقال للوحة التحكم
              </a>
            {% endif %}
          {% else %}
            <a href="{% url 'accounts:register' %}" class="btn btn-secondary">
              <i class="fas fa-rocket me-2"></i> ابدأ الآن
            </a>
          {% endif %}

          <a href="#how-it-works" class="btn btn-outline">
            <i class="fas fa-info-circle me-2"></i> تعرف على المنصة
          </a>
          
          <a href="{% url 'website:contact' %}" class="btn btn-outline">
            <i class="fas fa-envelope me-2"></i> تواصل معنا
          </a>
        </div>
      </div>

      <div class="hero-visual scroll-reveal">
        <div class="hero-card">
          <div class="hero-card-header">
            <h2 class="hero-card-title">مسار واحد واضح لكل الأطراف</h2>
            <p class="hero-card-description">رحلة منظمة من الطلب حتى التسليم</p>
          </div>

          <div class="hero-steps">
            <div class="hero-step">
              <div class="step-number">1</div>
              <div class="step-content">
                <div class="step-title">طلب موحد وواضح</div>
                <div class="step-description">
                  يقوم العميل بتحديد الاحتياج التقني، نوع الخدمة، المدة المتوقعة والميزانية بشكل منظم.
                </div>
              </div>
            </div>

            <div class="hero-step">
              <div class="step-number">2</div>
              <div class="step-content">
                <div class="step-title">عروض من تقنيين موثوقين</div>
                <div class="step-description">
                  تصل عروض من تقنيين سعوديين معتمدين داخل المنصة، مع تفاصيل السعر، المدة، ونطاق العمل.
                </div>
              </div>
            </div>

            <div class="hero-step">
              <div class="step-number">3</div>
              <div class="step-content">
                <div class="step-title">اتفاقية بمراحل وتسوية آمنة</div>
                <div class="step-description">
                  بعد اختيار العرض الأنسب تُنشأ اتفاقية بمراحل دفع واضحة،
                  وتتم إدارة التنفيذ والملاحظات داخل سامي لينك.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>
{% endblock %}

{% block content %}

<!-- قسم كيف تعمل المنصة -->
<section id="how-it-works" class="section how-it-works">
  <div class="container">
    <div class="section-header scroll-reveal">
      <div class="section-badge"><i class="fas fa-sync-alt me-2"></i> عملية منظمة</div>
      <h2 class="section-title">كيف تعمل منصة سامي لينك؟</h2>
      <p class="section-description">
        رحلة منظمة من الطلب حتى الإكمال، بخطوات بسيطة وواضحة لكل من العميل والتقني.
      </p>
    </div>

    <div class="steps-grid">
      <div class="step-card scroll-reveal">
        <div class="step-number-large">١</div>
        <div class="step-icon"><i class="fas fa-file-signature"></i></div>
        <h3 class="step-title">إنشاء الطلب</h3>
        <p class="step-description">
          يقوم العميل بإنشاء طلب جديد، وتوضيح طبيعة المشروع أو المهمة، والمدة المتوقعة والميزانية، مع إمكانية إرفاق ملفات توضيحية.
        </p>
      </div>

      <div class="step-card scroll-reveal">
        <div class="step-number-large">٢</div>
        <div class="step-icon"><i class="fas fa-briefcase"></i></div>
        <h3 class="step-title">استقبال العروض</h3>
        <p class="step-description">
          تُرسل إشعارات للتقنيين المناسبين، ويقومون بتقديم عروضهم داخل المنصة مع تفاصيل السعر، المدة، وطريقة التنفيذ.
        </p>
      </div>

      <div class="step-card scroll-reveal">
        <div class="step-number-large">٣</div>
        <div class="step-icon"><i class="fas fa-file-invoice-dollar"></i></div>
        <h3 class="step-title">الاتفاقية والفواتير</h3>
        <p class="step-description">
          بعد اختيار العرض الأنسب، تُنشأ اتفاقية تحتوي على مراحل عمل ودفعات، وتُربط آليًا بفواتير تصدر من المنصة.
        </p>
      </div>

      <div class="step-card scroll-reveal">
        <div class="step-number-large">٤</div>
        <div class="step-icon"><i class="fas fa-check-circle"></i></div>
        <h3 class="step-title">التنفيذ والتسليم</h3>
        <p class="step-description">
          يتم متابعة التنفيذ ورسائل المحادثة ورفع الملفات عبر المنصة، مع إمكانية فتح نزاع عند الحاجة لضبط حقوق جميع الأطراف.
        </p>
      </div>
    </div>
  </div>
</section>

<!-- قسم التقنيين - كروت صغيرة احترافية + صور -->
<section id="team" class="section team-section team-section--mini">
  <div class="container">
    <div class="section-header scroll-reveal">
      <div class="section-badge"><i class="fas fa-users me-2"></i> التقنيون</div>
      <h2 class="section-title">التقنيون السعوديون في سامي لينك</h2>
      <p class="section-description">
        تقنيون سعوديون تم التحقق من هوياتهم وخبراتهم قبل قبولهم في المنصة.
      </p>
    </div>

    {# دعم متغيرات قديمة/جديدة بدون كسر #}
    {% if featured_employees %}
      {% with tech_list=featured_employees %}
        {% include "website/_tech_mini_grid.html" %}
      {% endwith %}
    {% elif team_members %}
      {% with tech_list=team_members %}
        {% include "website/_tech_mini_grid.html" %}
      {% endwith %}
    {% else %}
      <div class="text-center py-5 text-muted">
        <i class="fas fa-users-slash fa-3x mb-3 opacity-50"></i>
        <p>لا يوجد تقنيون متاحون للعرض حالياً.</p>
      </div>
    {% endif %}

    <div class="center-actions scroll-reveal" style="margin-top: 1.75rem;">
      <a href="{% url 'profiles:employees_list' %}" class="btn btn-secondary">
        <i class="fas fa-users me-2"></i> عرض جميع التقنيين
      </a>
    </div>
  </div>
</section>

<!-- قسم التواصل -->
<section id="contact" class="section contact-section">
  <div class="container">
    <div class="contact-grid">
      <div class="contact-info scroll-reveal">
        <div class="section-header" style="text-align: right;">
          <div class="section-badge"><i class="fas fa-headset me-2"></i> دعم مستمر</div>
          <h2 class="section-title">{{ site_settings.contact_title|default:"تواصل مع فريق سامي لينك" }}</h2>
          <p class="section-description" style="margin: 0;">
            {{ site_settings.contact_description|default:"للاستفسارات، الشراكات، أو التجربة الأولى للمنصة؛ يسعدنا تواصلك معنا عبر البريد الإلكتروني أو الواتساب." }}
          </p>
        </div>

        <div class="contact-methods">
          <div class="contact-method">
            <div class="contact-icon"><i class="fas fa-envelope"></i></div>
            <div class="contact-details">
              <div class="contact-label">البريد الإلكتروني الرسمي</div>
              <a href="mailto:{{ site_settings.email|default:'support@samilink.sa' }}" class="contact-value">{{ site_settings.email|default:'support@samilink.sa' }}</a>
            </div>
          </div>

          <div class="contact-method">
            <div class="contact-icon"><i class="fab fa-whatsapp"></i></div>
            <div class="contact-details">
              <div class="contact-label">واتساب خدمة العملاء</div>
              <a href="https://wa.me/{{ site_settings.whatsapp|default:'966500000000'|cut:' ' }}" class="contact-value">{{ site_settings.whatsapp|default:'+966 50 000 0000' }}</a>
            </div>
          </div>

          <div class="contact-method">
            <div class="contact-icon"><i class="fas fa-clock"></i></div>
            <div class="contact-details">
              <div class="contact-label">أوقات العمل</div>
              <div class="contact-value">{{ site_settings.working_hours|default:'الأحد - الخميس: ٨ ص - ٥ م' }}</div>
            </div>
          </div>
        </div>

        <div style="margin-top: 2rem;">
          <a href="{% url 'website:contact' %}" class="btn btn-primary">
            <i class="fas fa-paper-plane me-2"></i> فتح نموذج التواصل
          </a>
        </div>
      </div>

      <div class="contact-sidebar scroll-reveal">
        <div class="sidebar-badge">
          <i class="fas fa-rocket me-2"></i>
          {{ site_settings.partnership_card_badge|default:'جاهزون لمرافقتك' }}
        </div>
        <h3 class="sidebar-title">{{ site_settings.partnership_card_title|default:'من أول طلب حتى التسليم' }}</h3>
        <p class="sidebar-description">
          {{ site_settings.partnership_card_description|default:'يمكن تهيئة المنصة للاستخدام الداخلي في شركتك أو فريقك، مع صلاحيات مالية وإدارية متقدمة وتقارير متابعة مخصصة بحسب احتياج الإدارة.' }}
        </p>


      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block extra_scripts %}
{{ block.super }}
<script>
(function() {

    // --- إخفاء تنبيه المنصّة بعد 3 ثواني ---
    var pn = document.getElementById("platformNoticeCard");
    var pnClose = document.getElementById("platformNoticeClose");
    if (pn) {
      var hidePlatformNotice = function(){
        pn.style.opacity = "0";
        pn.style.transform = "translateY(6px)";
        setTimeout(function(){ pn.remove(); }, 220);
      };

      setTimeout(hidePlatformNotice, 60000);

      if (pnClose) {
        pnClose.addEventListener("click", function(){
          hidePlatformNotice();
        });
      }
    }

    if (typeof initScrollReveal === 'function') {
        initScrollReveal();
    }
    if (typeof initGlobalAnimations === 'function') {
        initGlobalAnimations();
    }
    if (typeof initButtonEffects === 'function') {
        initButtonEffects();
    }

    document.addEventListener('DOMContentLoaded', function() {
        const ctaButtons = document.querySelectorAll('.hero-actions .btn');
        ctaButtons.forEach((btn, index) => {
            btn.style.animationDelay = `${index * 0.1 + 0.5}s`;
        });

        const stepCards = document.querySelectorAll('.step-card');
        stepCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-10px)';
                this.style.boxShadow = 'var(--shadow-xl)';
            });
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(-5px)';
                this.style.boxShadow = 'var(--shadow-lg)';
            });
        });

        const techCards = document.querySelectorAll('.mini-tech-card');
        techCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px) scale(1.02)';
            });
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });
    });

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                if (typeof scrollToElement === 'function') {
                    scrollToElement(target);
                } else {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        });
    });

    window.addEventListener('load', function() {
        document.body.classList.add('loaded');
        const revealElements = document.querySelectorAll('.scroll-reveal');
        revealElements.forEach((el, index) => {
            el.style.animationDelay = `${index * 0.1}s`;
        });
    });

})();
</script>

<style>
.hero-section {
    position: relative;
    overflow: hidden;
}
.hero-section::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -20%;
    width: 100%;
    height: 200%;
    background: radial-gradient(circle, rgba(34, 197, 94, 0.05) 0%, transparent 70%);
    z-index: -1;
}

.team-section--mini {
    background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
}

/* شبكة الكروت */
.mini-tech-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1rem;
    margin-top: 1.75rem;
    max-width: 980px;
    margin-left: auto;
    margin-right: auto;
}

.mini-tech-card {
    background: var(--white);
    border-radius: 16px;
    padding: 1rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--dark-200);
    transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
}

.mini-tech-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-md);
    border-color: var(--primary-200);
}

.mini-tech-head {
    display: flex;
    align-items: center;
    gap: .75rem;
    margin-bottom: .75rem;
}

/* الصورة الشخصية */
.mini-tech-avatar-wrapper {
    position: relative;
    flex: 0 0 auto;
}

.mini-tech-avatar {
    width: 52px;
    height: 52px;
    border-radius: 999px;
    overflow: hidden;
    background: var(--primary-50, #eff6ff);
    border: 2px solid var(--white);
    box-shadow: 0 0 0 2px var(--primary-100, #dbeafe);
}
.mini-tech-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display:block;
}

.verified-badge {
    position: absolute;
    bottom: 0;
    right: -2px;
    width: 18px;
    height: 18px;
    background: var(--primary-600, #2563eb);
    color: #fff;
    border-radius: 50%;
    border: 2px solid var(--white);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 9px;
}

.mini-tech-info {
    text-align: right;
    flex: 1;
    min-width: 0;
}

.mini-tech-name {
    font-weight: 800;
    color: var(--dark-900);
    margin-bottom: 0.1rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 1rem;
}

.mini-tech-sub {
    color: var(--muted, #64748b);
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 0.1rem;
}

.mini-tech-rating {
    font-size: 0.8rem;
    color: var(--dark-800);
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.mini-tech-skills {
    display: flex;
    flex-wrap: wrap;
    gap: .35rem;
}

.skill-tag-small{
    background: var(--primary-50, #eff6ff);
    border: 1px solid var(--primary-200, #bfdbfe);
    color: var(--primary-700, #1d4ed8);
    padding: .25rem .55rem;
    border-radius: 999px;
    font-size: .78rem;
    font-weight: 700;
}

.center-actions { text-align:center; }

@media (max-width: 768px) {
    .hero-content { grid-template-columns: 1fr; gap: 2rem; }
    .hero-title { font-size: 2.5rem; }
    .steps-grid { grid-template-columns: 1fr; }
    .contact-grid { grid-template-columns: 1fr; }
}

@media (max-width: 420px) {
    .mini-tech-grid { grid-template-columns: 1fr; }
}
</style>
{% endblock %}
