{% extends "dashboard/base_admin.html" %}
{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª{% endblock %}

{% block page_header %}
<section class="page-section admin-disputes-page">
  <div class="profile-section" style="background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%); border: none; margin-bottom: 1.5rem;">
    <div class="admin-header-content" style="display: flex; flex-direction: column; gap: 1.5rem;">
      <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 2rem;">
        <div style="flex: 1;">
          <div class="section-badge" style="margin-bottom: 1rem;">
            âš–ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª
          </div>
          <h1 class="section-title" style="margin-bottom: 0.5rem;">
            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª
          </h1>
          <p class="section-description">
            Ù…Ø±Ø§Ø¬Ø¹Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª ÙˆØ§ØªØ®Ø§Ø° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„ÙƒÙ„ Ø·Ù„Ø¨ ÙÙŠ Ø§Ù„Ù…Ù†ØµÙ‘Ø©.
          </p>
        </div>

        <div class="admin-meta" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; min-width: 220px;">
          <div class="profile-section text-center" style="padding: 1rem;">
            <div class="meta-label" style="font-size: 0.875rem; color: var(--dark-500); margin-bottom: 0.5rem;">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…</div>
            <div class="meta-value" style="font-size: 1.25rem; font-weight: 800; color: var(--dark-800);">{{ today|date:"Y-m-d" }}</div>
          </div>
          <div class="profile-section text-center" style="padding: 1rem;">
            <div class="meta-label" style="font-size: 0.875rem; color: var(--dark-500); margin-bottom: 0.5rem;">ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª</div>
            <div class="meta-value" style="font-size: 1.25rem; font-weight: 800; color: var(--dark-800);">
              {% if page_obj %}{{ page_obj.paginator.count }}{% else %}0{% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block content %}
<section class="page-section admin-disputes-page">
  <div class="container">

    <div class="profile-section" style="margin-bottom: 2rem;">
      <form method="get" class="filter-form">
        <div class="form-grid-5" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; margin-bottom: 1rem;">
          <div class="form-field" style="grid-column: span 2;">
            <label class="form-label">ğŸ” Ø¨Ø­Ø«</label>
            <input type="text" name="q" value="{{ q }}" class="input" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ù„ÙˆØµÙâ€¦">
          </div>

          <div class="form-field">
            <label class="form-label">ğŸ“… Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
            <input type="date" name="start" value="{{ start }}" class="input">
          </div>

          <div class="form-field">
            <label class="form-label">ğŸ“… Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
            <input type="date" name="end" value="{{ end }}" class="input">
          </div>

          <div class="form-field">
            <label class="form-label">ğŸ“Š Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <select name="status" class="input">
              <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
              <option value="open" {% if status == "open" %}selected{% endif %}>Ù…ÙØªÙˆØ­</option>
              <option value="in_review" {% if status == "in_review" %}selected{% endif %}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
              <option value="resolved" {% if status == "resolved" %}selected{% endif %}>Ù…Ø­Ø³ÙˆÙ…</option>
              <option value="canceled" {% if status == "canceled" %}selected{% endif %}>Ù…Ù„ØºÙŠ</option>
            </select>
          </div>
        </div>

        <div class="form-actions" style="display: flex; gap: 0.5rem;">
          <button class="btn btn-primary">
            ğŸ” Ø¨Ø­Ø«
          </button>
          <a href="." class="btn btn-outline">
            ğŸ”„ ØªØµÙÙŠØ±
          </a>
        </div>
      </form>
    </div>

    <div class="profile-section">
      <div class="table-wrapper">
        <table class="table table-clean">
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th>Ø§Ù„Ø·Ù„Ø¨</th>
              <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† / Ø§Ù„ÙˆØµÙ</th>
              <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
              <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
            {% if page_obj %}
              {% for d in page_obj %}
                <tr>
                  <td class="text-muted">D{{ d.id }}</td>

                  <td>
                    {% if d.status %}
                      {% if d.status == "open" %}
                        <span class="badge badge-pending">Ù…ÙØªÙˆØ­</span>
                      {% elif d.status == "in_review" %}
                        <span class="badge badge-default">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                      {% elif d.status == "resolved" %}
                        <span class="badge badge-verified">Ù…Ø­Ø³ÙˆÙ…</span>
                      {% elif d.status == "canceled" %}
                        <span class="badge badge-rejected">Ù…Ù„ØºÙŠ</span>
                      {% else %}
                        <span class="badge badge-default">{{ d.status }}</span>
                      {% endif %}
                    {% else %}
                      <span class="text-muted">-</span>
                    {% endif %}
                  </td>

                  <td>
                    {% if d.request_id %}
                      <span class="value-strong">#{{ d.request_id }}</span>
                    {% else %}
                      <span class="text-muted">-</span>
                    {% endif %}
                  </td>

                  <td>
                    <div class="table-cell-main">
                      <div class="table-cell-title">
                        {% if d.title %}
                          {{ d.title }}
                        {% else %}
                          <span class="text-muted">Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†</span>
                        {% endif %}
                      </div>
                      <div class="table-cell-subtitle">
                        {% if d.note %}
                          {{ d.note|truncatechars:80 }}
                        {% elif d.details %}
                          {{ d.details|truncatechars:80 }}
                        {% else %}
                          <span class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ø¥Ø¶Ø§ÙÙŠ</span>
                        {% endif %}
                      </div>
                    </div>
                  </td>

                  <td class="text-muted">
                    {% if d.created_at %}
                      {{ d.created_at|date:"Y-m-d H:i" }}
                    {% else %}
                      <span class="text-muted">-</span>
                    {% endif %}
                  </td>

                  <td>
                    <div class="table-actions">
                      <form method="post" action="{% url 'disputes:update_status' d.id %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" name="action" value="review" class="btn btn-secondary btn-sm">
                          ğŸ”„ ØªØ­Ø¯ÙŠØ«
                        </button>
                      </form>

                      {% if d.request_id %}
                        <a href="{% url 'disputes:detail' d.id %}" class="btn btn-outline btn-sm">
                          ğŸ‘ï¸ ØªÙØ§ØµÙŠÙ„
                        </a>
                      {% endif %}
                    </div>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="6" class="text-center text-muted" style="padding: 3rem;">
                    <div class="empty-state">
                      <div class="empty-icon" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">âš–ï¸</div>
                      <h3 class="empty-title" style="font-size: 1.2rem; margin-bottom: 0.5rem; color: var(--dark-600);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø²Ø§Ø¹Ø§Øª</h3>
                      <p class="empty-description" style="color: var(--dark-500);">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ø²Ø§Ø¹Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="6" class="text-center text-muted" style="padding: 3rem;">
                  <div class="empty-state">
                    <div class="empty-icon" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">ğŸ“Š</div>
                    <h3 class="empty-title" style="font-size: 1.2rem; margin-bottom: 0.5rem; color: var(--dark-600);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                    <p class="empty-description" style="color: var(--dark-500);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø²Ø§Ø¹Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§</p>
                  </div>
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    {% if page_obj %}
      <div class="pagination profile-section" style="text-align: center; padding: 1.5rem;">
        <div class="pagination-inner employee-actions">
          {% if page_obj.has_previous %}
            <a class="btn btn-outline btn-sm"
               href="?page={{ page_obj.previous_page_number }}&q={{ q }}&status={{ status }}&start={{ start }}&end={{ end }}">
              â€¹ Ø§Ù„Ø³Ø§Ø¨Ù‚
            </a>
          {% else %}
            <span class="btn btn-outline btn-sm" style="opacity: 0.5; cursor: not-allowed;">â€¹ Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
          {% endif %}

          <span class="pagination-info badge badge-default">
            Ø§Ù„ØµÙØ­Ø© {{ page_obj.number }} Ù…Ù† {{ page_obj.paginator.num_pages }}
          </span>

          {% if page_obj.has_next %}
            <a class="btn btn-outline btn-sm"
               href="?page={{ page_obj.next_page_number }}&q={{ q }}&status={{ status }}&start={{ start }}&end={{ end }}">
              Ø§Ù„ØªØ§Ù„ÙŠ â€º
            </a>
          {% else %}
            <span class="btn btn-outline btn-sm" style="opacity: 0.5; cursor: not-allowed;">Ø§Ù„ØªØ§Ù„ÙŠ â€º</span>
          {% endif %}
        </div>
      </div>
    {% endif %}

    {% if page_obj %}
    <div class="profile-section" style="background: var(--dark-50); margin-top: 2rem;">
      <div class="card-section-title">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</div>
      <div class="quick-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div class="stat-item">
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª</div>
          <div class="stat-number">{{ page_obj.paginator.count|default:0 }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</div>
          <div class="stat-number">
            {{ open_count }}
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
          <div class="stat-number">
            {{ review_count }}
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Ù…Ø­Ø³ÙˆÙ…Ø©</div>
          <div class="stat-number">
            {{ resolved_count }}
          </div>
        </div>
      </div>
    </div>
    {% endif %}

  </div>
</section>
{% endblock %}

{% block extra_scripts %}
{{ block.super }}
<script>
(function () {
  document.querySelectorAll('.btn').forEach(function (button) {
    button.addEventListener('click', function() {
      if (typeof animateButtonClick === 'function') {
        animateButtonClick(this);
      }
    });
  });

  var filterForm = document.querySelector('.filter-form');
  if (filterForm) {
    var inputs = filterForm.querySelectorAll('input, select');

    inputs.forEach(function (input) {
      input.addEventListener('focus', function() {
        this.style.borderColor = 'var(--primary-500)';
        this.style.boxShadow = '0 0 0 3px rgba(34, 197, 94, 0.1)';
      });

      input.addEventListener('blur', function() {
        this.style.borderColor = '';
        this.style.boxShadow = '';
      });

      input.addEventListener('change', function() {
        this.style.background = 'var(--primary-50)';
        setTimeout(() => {
          this.style.background = '';
        }, 500);
      });
    });

    var searchInput = filterForm.querySelector('input[name="q"]');
    if (searchInput) {
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          filterForm.submit();
        }
      });
    }
  }

  document.querySelectorAll('.table-clean tbody tr').forEach(function (row) {
    row.addEventListener('mouseenter', function() {
      this.style.background = 'var(--primary-50)';
    });

    row.addEventListener('mouseleave', function() {
      this.style.background = '';
    });
  });

  document.querySelectorAll('form[action*="update_status"]').forEach(function (form) {
    form.addEventListener('submit', function(e) {
      if (typeof showToast === 'function') {
        showToast('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø²Ø§Ø¹...', 'info');
      }
    });
  });
})();
</script>

<style>
.admin-disputes-page .form-grid-5 {
  grid-template-columns: repeat(5, 1fr);
}

.admin-disputes-page .form-field {
  margin-bottom: 0;
}

.admin-disputes-page .form-label {
  display: block;
  font-weight: 600;
  color: var(--dark-700);
  margin-bottom: 0.5rem;
  font-size: 0.95rem;
}

.admin-disputes-page .input {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 1px solid var(--dark-300);
  border-radius: var(--radius-lg);
  background: var(--white);
  font-family: inherit;
  font-size: 1rem;
  transition: var(--transition);
}

.admin-disputes-page .input:focus {
  outline: none;
  border-color: var(--primary-500);
  box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
}

.admin-disputes-page .table-wrapper {
  overflow-x: auto;
  border-radius: var(--radius-xl);
  border: 1px solid var(--dark-200);
}

.admin-disputes-page .table-clean {
  width: 100%;
  border-collapse: collapse;
}

.admin-disputes-page .table-clean th {
  background: var(--dark-50);
  color: var(--dark-700);
  font-weight: 600;
  padding: 1rem;
  text-align: right;
  border-bottom: 1px solid var(--dark-200);
}

.admin-disputes-page .table-clean td {
  padding: 1rem;
  border-bottom: 1px solid var(--dark-100);
  vertical-align: middle;
  transition: all 0.3s ease;
}

.admin-disputes-page .table-clean tr:last-child td {
  border-bottom: none;
}

.admin-disputes-page .table-cell-main {
  min-width: 300px;
  max-width: 400px;
}

.admin-disputes-page .table-cell-title {
  font-weight: 600;
  color: var(--dark-900);
  margin-bottom: 0.25rem;
}

.admin-disputes-page .table-cell-subtitle {
  color: var(--dark-600);
  font-size: 0.875rem;
  line-height: 1.4;
  word-wrap: break-word;
}

.admin-disputes-page .table-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.admin-disputes-page .text-muted {
  color: var(--dark-500);
}

.admin-disputes-page .text-center {
  text-align: center;
}

.admin-disputes-page .value-strong {
  font-weight: 700;
  color: var(--dark-900);
}

.admin-disputes-page .empty-state {
  padding: 2rem;
}

.admin-disputes-page .empty-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

.admin-disputes-page .empty-title {
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  color: var(--dark-600);
}

.admin-disputes-page .empty-description {
  color: var(--dark-500);
}

.admin-disputes-page .pagination-inner {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
}

.admin-disputes-page .pagination-info {
  padding: 0.5rem 1rem;
}

.admin-disputes-page .quick-stats {
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}

.admin-disputes-page .stat-item {
  text-align: center;
  padding: 1rem;
  background: var(--white);
  border-radius: var(--radius-lg);
  border: 1px solid var(--dark-200);
}

.admin-disputes-page .stat-label {
  font-size: 0.875rem;
  color: var(--dark-600);
  margin-bottom: 0.5rem;
}

.admin-disputes-page .stat-number {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--primary-600);
}

@media (max-width: 1024px) {
  .admin-disputes-page .form-grid-5 {
    grid-template-columns: 1fr 1fr;
  }

  .admin-disputes-page .form-field:first-child {
    grid-column: span 2;
  }
}

@media (max-width: 768px) {
  .admin-disputes-page .form-grid-5 {
    grid-template-columns: 1fr;
  }

  .admin-disputes-page .form-field:first-child {
    grid-column: span 1;
  }

  .admin-disputes-page .table-actions {
    flex-direction: column;
  }

  .admin-disputes-page .table-actions .btn {
    width: 100%;
  }

  .admin-disputes-page .pagination-inner {
    flex-direction: column;
    gap: 0.5rem;
  }

  .admin-disputes-page .quick-stats {
    grid-template-columns: repeat(2, 1fr);
  }

  .admin-disputes-page .table-cell-main {
    min-width: 200px;
    max-width: 250px;
  }
}

@media (max-width: 480px) {
  .admin-disputes-page .quick-stats {
    grid-template-columns: 1fr;
  }

  .admin-disputes-page .table-wrapper {
    font-size: 0.875rem;
  }

  .admin-disputes-page .table-clean th,
  .admin-disputes-page .table-clean td {
    padding: 0.75rem 0.5rem;
  }
}
</style>
{% endblock %}