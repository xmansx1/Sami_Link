{# dashboard/templates/dashboard/clients.html #}
{% extends "dashboard/base_admin.html" %}
{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡{% endblock %}

{# ===== Ù‡ÙŠØ¯Ø± Ø§Ù„ØµÙØ­Ø© (ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø§Ù„ØªÙˆØ¨ Ø¨Ø§Ø± ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©) ===== #}
{% block page_header %}
<div class="profile-section" style="margin-bottom: 1.5rem;">
  <div class="section-header" style="text-align: right;">
    <div class="section-badge">
      ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
    </div>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; gap: 1rem; flex-wrap: wrap;">
      <div>
        <h1 class="section-title" style="margin: 0;">
          Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        </h1>
        <div class="page-subtitle" style="color: var(--dark-500); font-size: 0.95rem; margin-top: 0.25rem;">
          Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ù†ØµÙ‘Ø©
        </div>
      </div>
      <div class="text-left" style="min-width: 220px;">
        <div class="profile-section text-center" style="padding: 0.8rem 1rem; margin: 0;">
          <div style="font-size: 0.85rem; color: var(--dark-500); margin-bottom: 0.25rem;">
            ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
          </div>
          <div style="font-size: 1.15rem; font-weight: 800; color: var(--dark-800);">
            {{ today|date:"Y-m-d" }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block content %}

<section class="page-section clients-management">
  <div class="container">
    
    {# ===== ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø« ===== #}
    <div class="profile-section" style="margin-bottom: 1.5rem;">
      <form method="get" class="search-form">
        <div class="form-grid-3" style="display: grid; grid-template-columns: 1fr auto auto; gap: 0.75rem; align-items: center;">
          <div class="form-field">
            <input type="text"
                   name="q"
                   value="{{ q }}"
                   class="input"
                   placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯â€¦">
          </div>
          <button class="btn btn-blue">
            Ø¨Ø­Ø«
          </button>
          <a href="." class="btn btn-gray">
            ğŸ”„ ØªØµÙÙŠØ±
          </a>
        </div>
      </form>
    </div>

    {# ===== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ===== #}
    <div class="profile-section">
      <div class="table-wrapper">
        <table class="table table-clean">
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
              <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
              <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</th>
              <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
            {% for u in page_obj %}
              <tr>
                <td class="text-muted">#{{ u.id }}</td>
                
                <td>
                  <div class="client-info">
                    <div class="client-name">
                      {% if u.name %}
                        {{ u.name }}
                      {% else %}
                        {% if u.get_full_name %}
                          {{ u.get_full_name }}
                        {% else %}
                          {{ u.username }}
                        {% endif %}
                      {% endif %}
                    </div>
                    {% if u.is_active %}
                      <span class="status-badge active">Ù†Ø´Ø·</span>
                    {% else %}
                      <span class="status-badge inactive">ØºÙŠØ± Ù†Ø´Ø·</span>
                    {% endif %}
                  </div>
                </td>
                
                <td>
                  <div class="email-cell">
                    {% if u.email %}
                      <a href="mailto:{{ u.email }}" class="email-link">
                        {{ u.email }}
                      </a>
                    {% else %}
                      <span class="text-muted">-</span>
                    {% endif %}
                  </div>
                </td>
                
                <td>
                  {% if u.phone %}
                    <div class="phone-cell">
                      <a href="tel:{{ u.phone }}" class="phone-link">
                        {{ u.phone }}
                      </a>
                    </div>
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </td>
                
                <td class="text-muted">
                  {% if u.date_joined %}
                    {{ u.date_joined|date:"Y-m-d" }}
                  {% else %}
                    -
                  {% endif %}
                </td>
                
                <td>
                  <div class="table-actions">
                    <a href="{% url 'admin:accounts_user_change' u.id %}" 
                       class="btn btn-sm btn-gray"
                       title="Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">
                      ğŸ‘ï¸ ØªÙØ§ØµÙŠÙ„
                    </a>
                    <a href="{% url 'admin:accounts_user_delete' u.id %}" 
                       class="btn btn-sm btn-rose"
                       title="Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„">
                      ğŸ—‘ï¸ Ø­Ø°Ù
                    </a>
                  </div>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="6" class="text-center empty-state">
                  <div class="empty-content">
                    <div class="empty-icon">ğŸ‘¥</div>
                    <h3 class="empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</h3>
                    <p class="empty-description">
                      {% if q %}
                        Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø·Ø§Ø¨Ù‚ÙŠÙ† Ù„Ø¨Ø­Ø«Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ
                      {% else %}
                        Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹
                      {% endif %}
                    </p>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    {# ===== ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª ===== #}
    {% if page_obj %}
      <div class="pagination profile-section" style="text-align: center; padding: 1.5rem;">
        <div class="pagination-inner employee-actions">
          {% if page_obj.has_previous %}
            <a class="btn btn-sm btn-gray"
               href="?page={{ page_obj.previous_page_number }}&q={{ q }}">
              â€¹ Ø§Ù„Ø³Ø§Ø¨Ù‚
            </a>
          {% else %}
            <span class="btn btn-sm btn-gray" style="opacity: 0.5; cursor: not-allowed;">â€¹ Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
          {% endif %}

          <span class="pagination-info badge badge-default">
            ØµÙØ­Ø© {{ page_obj.number }} Ù…Ù† {{ page_obj.paginator.num_pages }}
          </span>

          {% if page_obj.has_next %}
            <a class="btn btn-sm btn-gray"
               href="?page={{ page_obj.next_page_number }}&q={{ q }}">
              Ø§Ù„ØªØ§Ù„ÙŠ â€º
            </a>
          {% else %}
            <span class="btn btn-sm btn-gray" style="opacity: 0.5; cursor: not-allowed;">Ø§Ù„ØªØ§Ù„ÙŠ â€º</span>
          {% endif %}
        </div>
      </div>
    {% endif %}

    {# ===== Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© ===== #}
    {% if page_obj %}
    <div class="profile-section" style="background: var(--dark-50); margin-top: 1.5rem;">
      <div class="card-section-title">ğŸ“Š Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø©</div>
      <div class="quick-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div class="stat-item">
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Ø¶Ù…Ù† Ø§Ù„ÙÙ„ØªØ±Ø©)</div>
          <div class="stat-number">{{ page_obj.paginator.count|default:"0" }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</div>
          <div class="stat-number">{{ active_users_count|default:"-" }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div>
          <div class="stat-number">{{ monthly_registrations|default:"-" }}</div>
        </div>
      </div>
    </div>
    {% endif %}

  </div>
</section>

{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script>
  (function () {
    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.querySelectorAll('.clients-management .btn').forEach(function (button) {
      button.addEventListener('click', function () {
        if (typeof animateButtonClick === 'function') {
          animateButtonClick(this);
        }
      });
    });

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    document.querySelectorAll('.clients-management .table-clean tbody tr').forEach(function (row) {
      row.addEventListener('mouseenter', function () {
        this.style.background = '#f8fafc';
      });
      row.addEventListener('mouseleave', function () {
        this.style.background = '';
      });
    });

    // ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¨Ø­Ø«
    var searchForm = document.querySelector('.clients-management .search-form');
    var searchInput = searchForm ? searchForm.querySelector('input[name="q"]') : null;
    
    if (searchInput) {
      if (searchInput.value) {
        searchInput.style.borderColor = 'var(--brand)';
        searchInput.style.background = 'var(--primary-50)';
      }

      searchInput.addEventListener('focus', function () {
        this.style.borderColor = 'var(--brand)';
        this.style.boxShadow = '0 0 0 3px rgba(37, 99, 235, 0.12)';
      });
      
      searchInput.addEventListener('blur', function () {
        this.style.borderColor = '';
        this.style.boxShadow = '';
      });
    }

    // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„
    document.querySelectorAll('.clients-management a[href*="delete"]').forEach(function (link) {
      link.addEventListener('click', function (e) {
        var row = this.closest('tr');
        var nameEl = row ? row.querySelector('.client-name') : null;
        var clientName = nameEl ? nameEl.textContent.trim() : '';

        var msg = 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ\\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.';
        if (clientName) {
          msg = 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„:\\n' +
                clientName +
                '\\n\\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.';
        }

        if (!confirm(msg)) {
          e.preventDefault();
          return false;
        }
      });
    });

    // ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¨Ø±ÙŠØ¯/Ø§Ù„Ù‡Ø§ØªÙ
    document.querySelectorAll('.clients-management .email-link, .clients-management .phone-link').forEach(function (link) {
      link.addEventListener('mouseenter', function () {
        this.style.color = 'var(--brand)';
        this.style.textDecoration = 'underline';
      });
      link.addEventListener('mouseleave', function () {
        this.style.color = '';
        this.style.textDecoration = '';
      });
    });
  })();
  </script>

  <style>
  .clients-management .form-grid-3 {
    grid-template-columns: 1fr auto auto;
  }

  .clients-management .input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--dark-300);
    border-radius: var(--radius-lg);
    background: var(--white);
    font-family: inherit;
    font-size: 0.95rem;
    transition: var(--transition);
  }

  .clients-management .input:focus {
    outline: none;
    border-color: var(--brand);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.12);
  }

  .clients-management .table-wrapper {
    overflow-x: auto;
    border-radius: var(--radius-xl);
    border: 1px solid var(--dark-200);
    background: #fff;
  }

  .clients-management .table-clean {
    width: 100%;
    border-collapse: collapse;
  }

  .clients-management .table-clean th {
    background: #f8fafc;
    color: var(--dark-700);
    font-weight: 600;
    padding: 0.9rem 0.8rem;
    text-align: right;
    border-bottom: 1px solid var(--dark-200);
    white-space: nowrap;
    font-size: 0.86rem;
  }

  .clients-management .table-clean td {
    padding: 0.9rem 0.8rem;
    border-bottom: 1px solid #eef2f7;
    vertical-align: middle;
    font-size: 0.92rem;
  }

  .clients-management .table-clean tr:last-child td {
    border-bottom: none;
  }

  .clients-management .client-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    min-width: 160px;
  }

  .clients-management .client-name {
    font-weight: 600;
    color: var(--dark-900);
  }

  .clients-management .status-badge {
    font-size: 0.75rem;
    padding: 0.2rem 0.6rem;
    border-radius: 999px;
    width: fit-content;
    border: 1px solid transparent;
  }

  .clients-management .status-badge.active {
    background: #dcfce7;
    color: #166534;
    border-color: #bbf7d0;
  }

  .clients-management .status-badge.inactive {
    background: #f3f4f6;
    color: #4b5563;
    border-color: #e5e7eb;
  }

  .clients-management .email-cell,
  .clients-management .phone-cell {
    direction: ltr;
    text-align: right;
  }

  .clients-management .email-link,
  .clients-management .phone-link {
    color: var(--dark-700);
    text-decoration: none;
    transition: var(--transition);
  }

  .clients-management .text-muted {
    color: var(--dark-500);
  }

  .clients-management .table-actions {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
  }

  .clients-management .empty-state {
    padding: 2.5rem 1rem;
  }

  .clients-management .empty-content {
    text-align: center;
    color: var(--dark-500);
  }

  .clients-management .empty-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
  }

  .clients-management .empty-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--dark-700);
  }

  .clients-management .empty-description {
    font-size: 0.95rem;
    line-height: 1.6;
  }

  .clients-management .pagination-inner {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .clients-management .pagination-info {
    padding: 0.4rem 0.9rem;
  }

  .clients-management .quick-stats .stat-item {
    text-align: center;
    padding: 0.9rem;
    background: #fff;
    border-radius: var(--radius-lg);
    border: 1px solid var(--dark-150);
  }

  .clients-management .quick-stats .stat-label {
    font-size: 0.8rem;
    color: var(--dark-600);
    margin-bottom: 0.3rem;
  }

  .clients-management .quick-stats .stat-number {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--primary-600);
  }

  @media (max-width: 768px) {
    .clients-management .form-grid-3 {
      grid-template-columns: 1fr;
    }

    .clients-management .table-actions {
      flex-direction: column;
    }

    .clients-management .table-actions .btn {
      width: 100%;
      justify-content: center;
    }

    .clients-management .table-clean {
      font-size: 0.9rem;
    }
  }

  @media (max-width: 480px) {
    .clients-management .table-clean th,
    .clients-management .table-clean td {
      padding: 0.7rem 0.5rem;
    }
  }
  </style>
{% endblock %}
