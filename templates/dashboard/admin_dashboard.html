{% extends "dashboard/base_admin.html" %}
{% load humanize %}

{% block title %}Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© | Ø³Ø§Ù…ÙŠ Ù„ÙŠÙ†Ùƒ{% endblock %}

{% block page_header %}
<div class="dashboard-header">
  <div class="header-content">
    <div class="welcome-section">
      <div class="badge-pill">
        <span class="pulse-dot"></span>
        Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…
      </div>
      <h1 class="welcome-title">
        Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ {{ request.user.first_name|default:"Ø§Ù„Ù…Ø¯ÙŠØ±" }} ğŸ‘‹
      </h1>
      <p class="welcome-subtitle">
        Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ©ØŒ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©.
      </p>
    </div>

    <div class="header-stats">
      <div class="stat-pill">
        <span class="stat-icon">ğŸ“…</span>
        <div class="stat-info">
          <span class="stat-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…</span>
          <span class="stat-value">{{ today|date:"d F Y" }}</span>
        </div>
      </div>
      <div class="stat-pill">
        <span class="stat-icon">ğŸ‘¥</span>
        <div class="stat-info">
          <span class="stat-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
          <span class="stat-value">{{ users_total|default:0|intcomma }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="dashboard-container">

  {% url 'dashboard:all_requests' as all_requests_url %}
  {% url 'marketplace:request_list' as req_list_url %}
  {% url 'finance:invoice_list' as inv_list_url %}
  {% url 'disputes:list' as disputes_list_url %}
  {% url 'agreements:list' as agreements_list_url %}
  {% url 'accounts:user_list' as users_list_url %}

  {# --- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (Operational Alerts) --- #}
  {% if ops_alerts or delayed_requests %}
  <div class="alerts-section fade-in-up">
    {% if delayed_requests %}
    <div class="alert-card danger-alert">
      <div class="alert-icon-box">
        <span class="alert-icon">ğŸš¨</span>
      </div>
      <div class="alert-content">
        <h3 class="alert-title">ØªÙ†Ø¨ÙŠÙ‡: Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ØªØ£Ø®Ø±Ø© Ø¹Ù† Ø§Ù„ØªØ³Ù„ÙŠÙ…</h3>
        <p class="alert-desc">ÙŠÙˆØ¬Ø¯ <strong>{{ delayed_requests|length }}</strong> Ù…Ø´Ø§Ø±ÙŠØ¹ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù„ØªØ³Ù„ÙŠÙ…. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙÙˆØ±Ø§Ù‹.</p>
      </div>
      <div class="alert-action">
        <a href="#delayed-projects-table" class="btn-alert">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</a>
      </div>
    </div>
    {% endif %}

    {% for a in ops_alerts %}
      {% if "ÙØ§ØªÙˆØ±Ø© Ù…ØªØ£Ø®Ø±Ø©" in a %}
      <div class="alert-card warning-alert">
        <div class="alert-icon-box">
          <span class="alert-icon">âš ï¸</span>
        </div>
        <div class="alert-content">
          <h3 class="alert-title">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
          <p class="alert-desc">{{ a }}</p>
        </div>
        <div class="alert-action">
          <a href="{{ inv_list_url }}?status=overdue" class="btn-alert warning">Ù…ØªØ§Ø¨Ø¹Ø©</a>
        </div>
      </div>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}

  {# --- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª (KPI Cards) --- #}
  <div class="kpi-grid fade-in-up" style="animation-delay: 0.1s;">
    
    <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
    <div class="kpi-card primary-card">
      <div class="kpi-top">
        <div class="kpi-icon-wrapper">
          ğŸ“‹
        </div>
        <div class="kpi-trend positive">
          <span>Ù†Ø´Ø·</span>
          â†—
        </div>
      </div>
      <div class="kpi-body">
        <h3 class="kpi-value">{{ req_total|default:0|intcomma }}</h3>
        <p class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
      </div>
      <a href="{{ all_requests_url }}" class="kpi-link">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â†</a>
    </div>

    <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
    <div class="kpi-card secondary-card">
      <div class="kpi-top">
        <div class="kpi-icon-wrapper">
          ğŸ’³
        </div>
        <div class="kpi-trend neutral">
          <span>Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span>
        </div>
      </div>
      <div class="kpi-body">
        <h3 class="kpi-value">{{ inv_totals.total|default:0|floatformat:0|intcomma }} <small>Ø±.Ø³</small></h3>
        <p class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</p>
      </div>
      <a href="{{ inv_list_url }}" class="kpi-link">Ø§Ù„ØªÙØ§ØµÙŠÙ„ â†</a>
    </div>

    <!-- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
    <div class="kpi-card purple-card">
      <div class="kpi-top">
        <div class="kpi-icon-wrapper">
          ğŸ‘¥
        </div>
        <div class="kpi-trend">
          <span>{{ users_staff|default:0 }} Ù…ÙˆØ¸Ù</span>
        </div>
      </div>
      <div class="kpi-body">
        <h3 class="kpi-value">{{ users_total|default:0|intcomma }}</h3>
        <p class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
      </div>
      <a href="{{ users_list_url }}" class="kpi-link">Ø¥Ø¯Ø§Ø±Ø© â†</a>
    </div>

    <!-- Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª -->
    <div class="kpi-card danger-card">
      <div class="kpi-top">
        <div class="kpi-icon-wrapper">
          âš–ï¸
        </div>
        {% if disputes_recent %}
        <div class="kpi-trend negative">
          <span>{{ disputes_recent|length }} Ø¬Ø¯ÙŠØ¯</span>
        </div>
        {% endif %}
      </div>
      <div class="kpi-body">
        <h3 class="kpi-value">{{ disputes_recent|length|default:0 }}</h3>
        <p class="kpi-label">Ù†Ø²Ø§Ø¹Ø§Øª Ù†Ø´Ø·Ø©</p>
      </div>
      <a href="{{ disputes_list_url }}" class="kpi-link">ÙØ¶ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª â†</a>
    </div>
  </div>

  {# --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Content Management) --- #}
  {% if site_setting_id %}
  <div class="section-container fade-in-up" style="animation-delay: 0.15s;">
    <div class="section-header-row">
      <h2 class="section-heading">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>
      <span class="section-subtitle">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </div>
    
    <div class="kpi-grid" style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); margin-top: 1rem;">
        <div class="kpi-card" style="border-top: 4px solid #2563eb;">
            <div class="kpi-top">
                <div class="kpi-icon-wrapper" style="background: #eff6ff; color: #2563eb;">
                    ğŸ“
                </div>
                <div class="kpi-trend">
                    <span>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</span>
                </div>
            </div>
            <div class="kpi-body">
                <h3 class="kpi-value" style="font-size: 1.2rem;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
                <p class="kpi-label">ØªØ¹Ø¯ÙŠÙ„ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªÙˆØ§ØµÙ„ØŒ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†ØŒ ÙˆØ¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø´Ø±Ø§ÙƒØ©</p>
            </div>
            <a href="{% url 'admin:website_sitesetting_change' site_setting_id %}" class="kpi-link" target="_blank">
                ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª <i class="fas fa-external-link-alt"></i>
            </a>
        </div>
    </div>
  </div>
  {% endif %}

  {# --- Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ (Financial Overview) --- #}
  <div class="section-container fade-in-up" style="animation-delay: 0.2s;">
    <div class="section-header-row">
      <h2 class="section-heading">ğŸ’° Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ</h2>
      <span class="section-subtitle">Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span>
    </div>
    
    <div class="finance-summary-card">
      <div class="finance-item">
        <span class="fin-label">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</span>
        <span class="fin-value text-success">{{ inv_totals.paid|default:0|floatformat:2|intcomma }} <small>Ø±.Ø³</small></span>
        <div class="progress-bar"><div class="progress-fill success" style="width: 70%"></div></div>
      </div>
      <div class="finance-item">
        <span class="fin-label">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø³Ø¯Ø§Ø¯</span>
        <span class="fin-value text-warning">{{ inv_totals.unpaid|default:0|floatformat:2|intcomma }} <small>Ø±.Ø³</small></span>
        <div class="progress-bar"><div class="progress-fill warning" style="width: 40%"></div></div>
      </div>
      <div class="finance-item">
        <span class="fin-label">Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ù†ØµØ©</span>
        <span class="fin-value text-primary">{{ inv_totals.platform_fee_total|default:0|floatformat:2|intcomma }} <small>Ø±.Ø³</small></span>
        <div class="progress-bar"><div class="progress-fill primary" style="width: 100%"></div></div>
      </div>
      <div class="finance-item">
        <span class="fin-label">Ù…Ø¨Ø§Ù„Øº Ù…Ø¬Ù…Ù‘Ø¯Ø© (Ù†Ø²Ø§Ø¹)</span>
        <span class="fin-value text-danger">{{ inv_totals.disputed_total|default:0|floatformat:2|intcomma }} <small>Ø±.Ø³</small></span>
        <div class="progress-bar"><div class="progress-fill danger" style="width: 20%"></div></div>
      </div>
    </div>
  </div>

  {# --- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© (Delayed Projects) --- #}
  {% if delayed_requests %}
  <div id="delayed-projects-table" class="section-container fade-in-up" style="animation-delay: 0.3s;">
    <div class="section-header-row danger-theme">
      <h2 class="section-heading text-danger">ğŸš¨ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ØªØ£Ø®Ø±Ø©</h2>
      <span class="badge badge-danger">{{ delayed_requests|length }} Ù…Ø´Ø±ÙˆØ¹</span>
    </div>
    <div class="table-responsive card-shadow">
      <table class="modern-table">
        <thead>
          <tr>
            <th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
            <th>Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
            <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
            <th>Ù…Ø¯Ø© Ø§Ù„ØªØ£Ø®ÙŠØ±</th>
            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
          </tr>
        </thead>
        <tbody>
          {% for r in delayed_requests %}
          <tr>
            <td>
              <div class="table-main-text">{{ r.title }}</div>
              <div class="table-sub-text">#{{ r.id }}</div>
            </td>
            <td>
              <div class="user-cell">
                <div class="user-avatar sm">{{ r.assigned_employee.name|first|default:"?" }}</div>
                <span>{{ r.assigned_employee.name|default:r.assigned_employee }}</span>
              </div>
            </td>
            <td>{{ r.client.name|default:r.client }}</td>
            <td>
              <span class="status-pill danger">
                {{ r.overdue_days }} ÙŠÙˆÙ…
              </span>
            </td>
            <td>
              <a href="{% url 'marketplace:request_detail' r.id %}" class="btn-sm btn-outline-danger">Ù…ØªØ§Ø¨Ø¹Ø©</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}

  {# --- Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Main Tables Grid) --- #}
  <div class="tables-grid-layout fade-in-up" style="animation-delay: 0.4s;">
    
    <!-- Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
    <div class="grid-column">
      <div class="section-header-row">
        <h3 class="section-heading">ğŸ§¾ Ø£Ø­Ø¯Ø« Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
        <a href="{{ all_requests_url }}" class="link-subtle">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
      </div>
      <div class="card-shadow table-card">
        <table class="modern-table compact">
          <thead>
            <tr>
              <th>Ø§Ù„Ø·Ù„Ø¨</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            </tr>
          </thead>
          <tbody>
            {% for r in req_recent|slice:":6" %}
            <tr>
              <td>
                <a href="{% url 'marketplace:request_detail' r.id %}" class="table-link">
                  {{ r.title|truncatechars:30 }}
                </a>
                <div class="table-sub-text">#{{ r.id }} â€¢ {{ r.client.name|default:r.client }}</div>
              </td>
              <td>
                <span class="status-dot 
                  {% if r.status == 'completed' %}success
                  {% elif r.status == 'in_progress' %}primary
                  {% elif r.status == 'new' %}neutral
                  {% elif r.status == 'cancelled' %}danger
                  {% else %}warning{% endif %}">
                </span>
                <span class="status-text">{{ r.get_status_display }}</span>
              </td>
              <td class="text-muted text-sm">{{ r.created_at|date:"d/m" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="3" class="text-center py-4 text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø¯ÙŠØ«Ø©</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Ø¢Ø®Ø± Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
    <div class="grid-column">
      <div class="section-header-row">
        <h3 class="section-heading">ğŸ’³ Ø£Ø­Ø¯Ø« Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
        <a href="{{ inv_list_url }}" class="link-subtle">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
      </div>
      <div class="card-shadow table-card">
        <table class="modern-table compact">
          <thead>
            <tr>
              <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            </tr>
          </thead>
          <tbody>
            {% for inv in inv_recent|slice:":6" %}
            <tr>
              <td class="font-weight-bold">
                {{ inv.amount|default:inv.total_amount|floatformat:0 }} <small>Ø±.Ø³</small>
              </td>
              <td>
                {% if inv.status == 'paid' or inv.is_paid %}
                  <span class="status-pill success-light">Ù…Ø¯ÙÙˆØ¹Ø©</span>
                {% else %}
                  <span class="status-pill warning-light">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©</span>
                {% endif %}
              </td>
              <td class="text-muted text-sm">{{ inv.issued_at|date:"d/m" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="3" class="text-center py-4 text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ø­Ø¯ÙŠØ«Ø©</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>

  {# --- Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø© (Quick Actions) --- #}
  <div class="quick-actions-section fade-in-up" style="animation-delay: 0.5s;">
    <h3 class="section-heading mb-3">âš¡ ÙˆØµÙˆÙ„ Ø³Ø±ÙŠØ¹</h3>
    <div class="quick-grid">
      {% for ql in quick %}
        {% if ql.url %}
        <a href="{{ ql.url }}" class="quick-tile">
          <div class="tile-icon">
            {% if ql.icon == 'fa-receipt' %}ğŸ§¾
            {% elif ql.icon == 'fa-list' %}ğŸ“‹
            {% elif ql.icon == 'fa-file-signature' %}ğŸ“
            {% elif ql.icon == 'fa-scale-balanced' %}âš–ï¸
            {% elif ql.icon == 'fa-users' %}ğŸ‘¥
            {% else %}âš¡{% endif %}
          </div>
          <span class="tile-label">{{ ql.label }}</span>
        </a>
        {% endif %}
      {% endfor %}
    </div>
  </div>

</div>
{% endblock %}

{% block extra_scripts %}
<style>
  /* --- Dashboard Variables --- */
  :root {
    --dash-bg: #f8fafc;
    --card-bg: #ffffff;
    --primary-soft: #f0fdf4;
    --primary-strong: #16a34a;
    --danger-soft: #fef2f2;
    --danger-strong: #dc2626;
    --warning-soft: #fffbeb;
    --warning-strong: #d97706;
    --text-main: #1e293b;
    --text-sub: #64748b;
    --border-light: #e2e8f0;
    --shadow-card: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
    --shadow-hover: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.05);
    --radius-card: 16px;
  }

  /* --- Layout & Typography --- */
  .dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1.5rem;
    font-family: 'Tajawal', sans-serif;
    color: var(--text-main);
  }

  .section-heading {
    font-size: 1.25rem;
    font-weight: 800;
    color: var(--text-main);
    margin: 0;
  }

  .section-subtitle {
    font-size: 0.9rem;
    color: var(--text-sub);
    margin-right: 0.5rem;
  }

  .section-header-row {
    display: flex;
    align-items: baseline;
    margin-bottom: 1rem;
    gap: 0.5rem;
  }

  .link-subtle {
    margin-right: auto;
    font-size: 0.85rem;
    color: var(--primary-strong);
    text-decoration: none;
    font-weight: 600;
  }

  /* --- Header --- */
  .dashboard-header {
    background: linear-gradient(120deg, #ffffff 0%, #f0fdf4 100%);
    padding: 2rem 1.5rem;
    border-bottom: 1px solid var(--border-light);
    margin-bottom: 2rem;
  }

  .header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    flex-wrap: wrap;
    gap: 1.5rem;
  }

  .badge-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(22, 163, 74, 0.1);
    color: var(--primary-strong);
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .pulse-dot {
    width: 8px;
    height: 8px;
    background: var(--primary-strong);
    border-radius: 50%;
    box-shadow: 0 0 0 0 rgba(22, 163, 74, 0.7);
    animation: pulse-green 2s infinite;
  }

  .welcome-title {
    font-size: 1.8rem;
    font-weight: 900;
    margin: 0 0 0.25rem 0;
    color: var(--dark-900);
  }

  .welcome-subtitle {
    color: var(--text-sub);
    margin: 0;
    font-size: 1rem;
  }

  .header-stats {
    display: flex;
    gap: 1rem;
  }

  .stat-pill {
    background: #fff;
    padding: 0.75rem 1.25rem;
    border-radius: 12px;
    box-shadow: var(--shadow-card);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    border: 1px solid var(--border-light);
  }

  .stat-icon { font-size: 1.5rem; }
  
  .stat-info {
    display: flex;
    flex-direction: column;
    line-height: 1.2;
  }

  .stat-label { font-size: 0.75rem; color: var(--text-sub); }
  .stat-value { font-weight: 800; color: var(--text-main); font-size: 1rem; }

  /* --- Alerts --- */
  .alerts-section { margin-bottom: 2rem; display: flex; flex-direction: column; gap: 1rem; }
  
  .alert-card {
    display: flex;
    align-items: center;
    padding: 1rem;
    border-radius: 12px;
    gap: 1rem;
    border: 1px solid transparent;
  }

  .danger-alert { background: #fef2f2; border-color: #fecaca; }
  .warning-alert { background: #fffbeb; border-color: #fde68a; }

  .alert-icon-box {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.5);
    border-radius: 50%;
    font-size: 1.25rem;
  }

  .alert-content { flex: 1; }
  .alert-title { font-size: 1rem; font-weight: 700; margin: 0 0 0.25rem 0; }
  .alert-desc { font-size: 0.9rem; margin: 0; opacity: 0.9; }
  
  .btn-alert {
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    text-decoration: none;
    background: #fff;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    transition: all 0.2s;
  }
  
  .danger-alert .alert-title { color: #991b1b; }
  .danger-alert .alert-desc { color: #b91c1c; }
  .danger-alert .btn-alert { color: #991b1b; border: 1px solid #fecaca; }
  
  .warning-alert .alert-title { color: #92400e; }
  .warning-alert .alert-desc { color: #b45309; }
  .warning-alert .btn-alert { color: #92400e; border: 1px solid #fde68a; }

  /* --- KPI Cards --- */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2.5rem;
  }

  .kpi-card {
    background: var(--card-bg);
    border-radius: var(--radius-card);
    padding: 1.5rem;
    box-shadow: var(--shadow-card);
    border: 1px solid var(--border-light);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .kpi-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-hover);
  }

  .kpi-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
  }

  .kpi-icon-wrapper {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
  }

  .primary-card .kpi-icon-wrapper { background: var(--primary-soft); color: var(--primary-strong); }
  .secondary-card .kpi-icon-wrapper { background: var(--warning-soft); color: var(--warning-strong); }
  .purple-card .kpi-icon-wrapper { background: #f3e8ff; color: #7c3aed; }
  .danger-card .kpi-icon-wrapper { background: var(--danger-soft); color: var(--danger-strong); }

  .kpi-trend {
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
  }
  .kpi-trend.positive { background: #dcfce7; color: #166534; }
  .kpi-trend.negative { background: #fee2e2; color: #991b1b; }
  .kpi-trend.neutral { background: #f1f5f9; color: #475569; }

  .kpi-value { font-size: 2rem; font-weight: 800; margin: 0; line-height: 1; color: var(--dark-900); }
  .kpi-value small { font-size: 1rem; font-weight: 600; color: var(--text-sub); }
  .kpi-label { color: var(--text-sub); margin: 0.5rem 0 0 0; font-size: 0.9rem; }
  
  .kpi-link {
    margin-top: 1.5rem;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-sub);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    transition: color 0.2s;
  }
  .kpi-link:hover { color: var(--primary-strong); }

  /* --- Finance Summary --- */
  .finance-summary-card {
    background: var(--card-bg);
    border-radius: var(--radius-card);
    padding: 2rem;
    box-shadow: var(--shadow-card);
    border: 1px solid var(--border-light);
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 2rem;
    margin-bottom: 2.5rem;
  }

  .finance-item { display: flex; flex-direction: column; gap: 0.5rem; }
  .fin-label { font-size: 0.85rem; color: var(--text-sub); font-weight: 600; }
  .fin-value { font-size: 1.25rem; font-weight: 800; }
  
  .text-success { color: var(--primary-strong); }
  .text-warning { color: var(--warning-strong); }
  .text-danger { color: var(--danger-strong); }
  .text-primary { color: #2563eb; }

  .progress-bar {
    height: 6px;
    background: #f1f5f9;
    border-radius: 3px;
    overflow: hidden;
    margin-top: 0.25rem;
  }
  .progress-fill { height: 100%; border-radius: 3px; }
  .progress-fill.success { background: var(--primary-strong); }
  .progress-fill.warning { background: var(--warning-strong); }
  .progress-fill.danger { background: var(--danger-strong); }
  .progress-fill.primary { background: #2563eb; }

  /* --- Tables --- */
  .tables-grid-layout {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 2.5rem;
  }

  .card-shadow {
    background: var(--card-bg);
    border-radius: var(--radius-card);
    box-shadow: var(--shadow-card);
    border: 1px solid var(--border-light);
    overflow: hidden;
  }

  .modern-table { width: 100%; border-collapse: collapse; }
  .modern-table th {
    background: #f8fafc;
    padding: 1rem 1.5rem;
    text-align: right;
    font-size: 0.85rem;
    color: var(--text-sub);
    font-weight: 600;
    border-bottom: 1px solid var(--border-light);
  }
  .modern-table td {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-light);
    vertical-align: middle;
  }
  .modern-table tr:last-child td { border-bottom: none; }
  .modern-table tr:hover { background: #fcfcfc; }

  .table-main-text { font-weight: 700; color: var(--dark-900); font-size: 0.95rem; }
  .table-sub-text { font-size: 0.8rem; color: var(--text-sub); margin-top: 0.2rem; }
  .table-link { text-decoration: none; color: inherit; transition: color 0.2s; font-weight: 700; }
  .table-link:hover { color: var(--primary-strong); }

  .user-cell { display: flex; align-items: center; gap: 0.75rem; }
  .user-avatar.sm {
    width: 32px; height: 32px;
    background: #e2e8f0; color: #64748b;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.8rem; font-weight: 700;
  }

  .status-pill {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
  }
  .status-pill.danger { background: #fef2f2; color: #dc2626; }
  .status-pill.success-light { background: #f0fdf4; color: #16a34a; }
  .status-pill.warning-light { background: #fffbeb; color: #d97706; }

  .status-dot {
    display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-left: 0.4rem;
  }
  .status-dot.success { background: #22c55e; }
  .status-dot.primary { background: #3b82f6; }
  .status-dot.warning { background: #f59e0b; }
  .status-dot.danger { background: #ef4444; }
  .status-dot.neutral { background: #94a3b8; }
  .status-text { font-size: 0.85rem; font-weight: 600; }

  /* --- Quick Actions --- */
  .quick-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 1rem;
  }
  .quick-tile {
    background: var(--card-bg);
    border: 1px solid var(--border-light);
    border-radius: 16px;
    padding: 1.5rem;
    text-align: center;
    text-decoration: none;
    color: var(--text-main);
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
  }
  .quick-tile:hover {
    transform: translateY(-3px);
    border-color: var(--primary-200);
    background: var(--primary-soft);
  }
  .tile-icon { font-size: 1.75rem; }
  .tile-label { font-size: 0.9rem; font-weight: 600; }

  /* --- Animations --- */
  @keyframes pulse-green {
    0% { box-shadow: 0 0 0 0 rgba(22, 163, 74, 0.7); }
    70% { box-shadow: 0 0 0 6px rgba(22, 163, 74, 0); }
    100% { box-shadow: 0 0 0 0 rgba(22, 163, 74, 0); }
  }

  .fade-in-up {
    animation: fadeInUp 0.6s ease-out forwards;
    opacity: 0;
    transform: translateY(20px);
  }

  @keyframes fadeInUp {
    to { opacity: 1; transform: translateY(0); }
  }

  /* --- Responsive --- */
  @media (max-width: 768px) {
    .header-content { flex-direction: column; align-items: flex-start; }
    .header-stats { width: 100%; }
    .stat-pill { flex: 1; }
    .tables-grid-layout { grid-template-columns: 1fr; }
  }
</style>
{% endblock %}