{% extends "dashboard/base_admin.html" %}
{% load humanize %}

{% block title %}Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±{% endblock %}

{% block page_header %}
<div class="profile-section admin-dashboard" style="background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%); border: none;">
  <div class="admin-header-content" style="display: flex; flex-direction: column; gap: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 2rem;">
      <div style="flex: 1;">
        <div class="section-badge" style="margin-bottom: 1rem;">
          ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…
        </div>
        <h1 class="section-title" style="margin-bottom: 0.5rem;">
          Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        </h1>
        <p class="section-description">
          Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†ØµÙ‘Ø© ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ø§ØªÙØ§Ù‚ÙŠØ§Øª ÙˆØ§Ù„Ù†Ø²Ø§Ø¹Ø§Øª ÙÙŠ Ù†Ø¸Ø±Ø© ÙˆØ§Ø­Ø¯Ø©.
        </p>
      </div>

      <div class="admin-meta" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; min-width: 220px;">
        <div class="profile-section text-center" style="padding: 1rem;">
          <div class="meta-label" style="font-size: 0.875rem; color: var(--dark-500); margin-bottom: 0.5rem;">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…</div>
          <div class="meta-value" style="font-size: 1.25rem; font-weight: 800; color: var(--dark-800);">{{ today|date:"Y-m-d" }}</div>
        </div>
        <div class="profile-section text-center" style="padding: 1rem;">
          <div class="meta-label" style="font-size: 0.875rem; color: var(--dark-500); margin-bottom: 0.5rem;">ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
          <div class="meta-value" style="font-size: 1.25rem; font-weight: 800; color: var(--dark-800);">{{ users_total|default:0|intcomma }}</div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="admin-dashboard">

  {% url 'dashboard:all_requests' as all_requests_url %}
  {% url 'marketplace:request_list' as req_list_url %}
  {% url 'finance:invoice_list' as inv_list_url %}
  {% url 'disputes:list' as disputes_list_url %}
  {% url 'agreements:list' as agreements_list_url %}
  {% url 'accounts:user_list' as users_list_url %}
  {% url 'marketplace:offers_list' as offers_list_url %}

  <div style="margin-bottom: 1.5rem; text-align: left;">
    <a href="{{ all_requests_url }}" class="btn btn-primary" style="font-size: 1.05rem;">
      <span style="font-size:1.3em;vertical-align:middle;">ğŸ“‹</span>
      <span style="vertical-align:middle;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
    </a>
  </div>

  {% if ops_alerts %}
  <div class="profile-section" style="background: var(--secondary-50); border-color: var(--secondary-200); margin-bottom: 2rem;">
    <div class="card-section-title">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØªØ´ØºÙŠÙ„ÙŠØ©</div>
    <p class="card-section-note" style="margin-bottom: 1rem;">ØªØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø©</p>
    <div class="alerts-list" style="display: flex; flex-direction: column; gap: 0.75rem;">
      {% for a in ops_alerts %}
        <div class="alert-item" style="display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.75rem; background: var(--white); border-radius: var(--radius-lg); border: 1px solid var(--secondary-200);">
          <span class="alert-dot" style="width: 6px; height: 6px; background: var(--secondary-500); border-radius: 50%; margin-top: 0.5rem; flex-shrink: 0;"></span>
          <span class="alert-text" style="color: var(--secondary-700); font-size: 0.9rem; line-height: 1.4;">{{ a }}</span>
        </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <div class="section-header" style="margin-bottom: 1.5rem;">
    <h2 class="section-title">ğŸ“Š Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
    <p class="section-description">Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµÙ‘Ø©</p>
  </div>

  <div class="kpi-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
    
    <div class="profile-section kpi-card">
      <div class="kpi-header" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
        <div class="kpi-icon" style="width: 3rem; height: 3rem; background: var(--primary-100); color: var(--primary-600); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
          ğŸ“‹
        </div>
        <div>
          <h3 class="card-section-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
          <p class="card-section-note">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</p>
        </div>
      </div>
      <div class="kpi-value" style="font-size: 2.5rem; font-weight: 800; color: var(--primary-600); margin-bottom: 1rem;">
        {{ req_total|default:0|intcomma }}
      </div>
      <div class="kpi-actions">
        {% if urls.requests or req_list_url %}
          <a href="{{ all_requests_url }}" class="btn btn-outline btn-sm">
            Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
          </a>
        {% else %}
          <span class="btn btn-outline btn-sm" style="opacity: 0.6;">â€”</span>
        {% endif %}
      </div>
    </div>

    <div class="profile-section kpi-card">
      <div class="kpi-header" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
        <div class="kpi-icon" style="width: 3rem; height: 3rem; background: #f3e8ff; color: #7c3aed; border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
          ğŸ‘¥
        </div>
        <div>
          <h3 class="card-section-title">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</h3>
          <p class="card-section-note">Ù…ÙˆØ¸ÙÙˆÙ†: {{ users_staff|default:0|intcomma }}</p>
        </div>
      </div>
      <div class="kpi-value" style="font-size: 2.5rem; font-weight: 800; color: #7c3aed; margin-bottom: 1rem;">
        {{ users_total|default:0|intcomma }}
      </div>
      <div class="kpi-actions">
        {% if urls.users or users_list_url %}
          <a href="{{ urls.users|default:users_list_url }}" class="btn btn-outline btn-sm">
            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
          </a>
        {% else %}
          <span class="btn btn-outline btn-sm" style="opacity: 0.6;">â€”</span>
        {% endif %}
      </div>
    </div>

    <div class="profile-section kpi-card">
      <div class="kpi-header" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
        <div class="kpi-icon" style="width: 3rem; height: 3rem; background: var(--secondary-100); color: var(--secondary-600); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
          ğŸ’³
        </div>
        <div>
          <h3 class="card-section-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
          <p class="card-section-note">Ù…Ø¯ÙÙˆØ¹Ø© + ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©</p>
        </div>
      </div>
      <div class="kpi-value" style="font-size: 2rem; font-weight: 800; color: var(--secondary-600); margin-bottom: 1rem;">
        {{ inv_totals.total|default:0|floatformat:2|intcomma }} Ø±.Ø³
      </div>
      <div class="kpi-actions">
        {% if urls.invoices or inv_list_url %}
          <a href="{{ urls.invoices|default:inv_list_url }}" class="btn btn-outline btn-sm">
            ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
          </a>
        {% else %}
          <span class="btn btn-outline btn-sm" style="opacity: 0.6;">â€”</span>
        {% endif %}
      </div>
    </div>

    <div class="profile-section kpi-card">
      <div class="kpi-header" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
        <div class="kpi-icon" style="width: 3rem; height: 3rem; background: #fef2f2; color: #ef4444; border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
          â³
        </div>
        <div>
          <h3 class="card-section-title">ÙÙˆØ§ØªÙŠØ± Ù…ØªØ£Ø®Ø±Ø©</h3>
          <p class="card-section-note">Ø£Ù‚Ø¯Ù… Ù…Ù† 3 Ø£ÙŠØ§Ù…</p>
        </div>
      </div>
      <div class="kpi-value" style="font-size: 2.5rem; font-weight: 800; color: #ef4444; margin-bottom: 1rem;">
        {{ overdue_count|default:0|intcomma }}
      </div>
      <div class="kpi-actions">
        <a href="{% url 'finance:invoice_list' %}?status=overdue" class="btn btn-outline btn-sm" style="background: #fef2f2; color: #ef4444; border-color: #fecaca;">
          Ù…ØªØ§Ø¨Ø¹Ø©
        </a>
      </div>
    </div>
  </div>

  <div class="section-header" style="margin-bottom: 1rem;">
    <h3 class="section-title">ğŸ’° Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h3>
    <p class="section-description">ØªÙØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº ÙˆØ§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª</p>
  </div>

  <div class="finance-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
    <div class="profile-section text-center">
      <div class="finance-label" style="font-size: 0.875rem; color: var(--dark-500); margin-bottom: 0.5rem;">Ù…Ø¯ÙÙˆØ¹</div>
      <div class="finance-value" style="font-size: 1.5rem; font-weight: 700; color: var(--primary-600);">
        {{ inv_totals.paid|default:0|floatformat:2|intcomma }} Ø±.Ø³
      </div>
    </div>
    
    <div class="profile-section text-center">
      <div class="finance-label" style="font-size: 0.875rem; color: var(--dark-500); margin-bottom: 0.5rem;">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹</div>
      <div class="finance-value" style="font-size: 1.5rem; font-weight: 700; color: var(--secondary-600);">
        {{ inv_totals.unpaid|default:0|floatformat:2|intcomma }} Ø±.Ø³
      </div>
    </div>
    
    <div class="profile-section text-center">
      <div class="finance-label" style="font-size: 0.875rem; color: var(--dark-500); margin-bottom: 0.5rem;">Ù…Ø¬Ù…Ù‘Ø¯ (Ù†Ø²Ø§Ø¹Ø§Øª)</div>
      <div class="finance-value" style="font-size: 1.5rem; font-weight: 700; color: #ef4444;">
        {{ inv_totals.disputed_total|default:0|floatformat:2|intcomma }} Ø±.Ø³
      </div>
    </div>
    
    <div class="profile-section text-center">
      <div class="finance-label" style="font-size: 0.875rem; color: var(--dark-500); margin-bottom: 0.5rem;">Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (VAT)</div>
      <div class="finance-value" style="font-size: 1.5rem; font-weight: 700; color: var(--dark-700);">
        {{ inv_totals.vat_total|default:0|floatformat:2|intcomma }} Ø±.Ø³
      </div>
    </div>
    
    <div class="profile-section text-center">
      <div class="finance-label" style="font-size: 0.875rem; color: var(--dark-500); margin-bottom: 0.5rem;">Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ù†ØµÙ‘Ø©</div>
      <div class="finance-value" style="font-size: 1.5rem; font-weight: 700; color: var(--primary-600);">
        {{ inv_totals.platform_fee_total|default:0|floatformat:2|intcomma }} Ø±.Ø³
      </div>
    </div>
  </div>

  <div class="tables-grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
    
    <div class="profile-section">
      <div class="data-card-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h3 class="card-section-title">ğŸ§¾ Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
        <a href="{% url 'dashboard:all_requests' %}" class="btn btn-outline btn-sm">
          Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        </a>
      </div>
      
      <div class="table-wrapper">
        <table class="table table-clean">
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
              <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            </tr>
          </thead>
          <tbody>
            {% for r in req_recent|slice:":5" %}
              <tr>
                <td class="text-muted">#{{ r.id }}</td>
                <td>{{ r.title|default:"â€”" }}</td>
                <td>
                  {% if r.client %}
                    {% if r.client.name %}
                      {{ r.client.name }}
                    {% elif r.client.phone %}
                      {{ r.client.phone }}
                    {% elif r.client.email %}
                      {{ r.client.email }}
                    {% else %}
                      {{ r.client }}
                    {% endif %}
                  {% else %}
                    â€”
                  {% endif %}
                </td>
                <td>
                  {% if r.status %}
                    <span class="badge 
                      {% if r.status == 'completed' %}badge-verified
                      {% elif r.status == 'new' %}badge-default
                      {% elif r.status == 'in_progress' %}badge-pending
                      {% elif r.status == 'disputed' %}badge-rejected
                      {% elif r.status == 'cancelled' %}badge-rejected
                      {% else %}badge-default{% endif %}">
                      {{ r.status }}
                    </span>
                  {% elif r.state %}
                    <span class="badge badge-default">{{ r.state }}</span>
                  {% else %}
                    <span class="badge badge-default">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                  {% endif %}
                </td>
                <td class="text-muted">
                  {% if r.created_at %}
                    {{ r.created_at|date:"Y-m-d H:i" }}
                  {% else %}
                    {{ r.id }}
                  {% endif %}
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="text-center text-muted" style="padding: 2rem;">
                  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø¯ÙŠØ«Ø©
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="profile-section">
      <div class="data-card-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h3 class="card-section-title">âš–ï¸ Ø¢Ø®Ø± Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª</h3>
        {% if urls.disputes or disputes_list_url %}
          <a href="{{ urls.disputes|default:disputes_list_url }}" class="btn btn-outline btn-sm">
            ÙƒÙ„ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª
          </a>
        {% endif %}
      </div>
      
      <div class="disputes-list" style="display: flex; flex-direction: column; gap: 1rem;">
        {% for d in disputes_recent|slice:":3" %}
          <div class="profile-section" style="border: 2px dashed var(--dark-200); padding: 1rem;">
            <div class="dispute-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
              <div class="dispute-title" style="font-weight: 600; color: var(--dark-800);">
                {% if d.request %}
                  Ù†Ø²Ø§Ø¹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ #{{ d.request.id }}
                {% else %}
                  Ù†Ø²Ø§Ø¹ #{{ d.id }}
                {% endif %}
              </div>
              <span class="badge badge-rejected">
                {% if d.status %}{{ d.status }}{% elif d.state %}{{ d.state }}{% else %}ØºÙŠØ± Ù…Ø­Ø¯Ø¯{% endif %}
              </span>
            </div>
            
            {% if d.reason %}
              <div class="dispute-reason" style="color: var(--dark-600); font-size: 0.875rem; line-height: 1.4; margin-bottom: 0.5rem;">
                {{ d.reason|truncatewords:20 }}
              </div>
            {% elif d.note %}
              <div class="dispute-reason" style="color: var(--dark-600); font-size: 0.875rem; line-height: 1.4; margin-bottom: 0.5rem;">
                {{ d.note|truncatewords:20 }}
              </div>
            {% endif %}
            
            <div class="dispute-date" style="color: var(--dark-500); font-size: 0.75rem;">
              {% if d.created_at %}
                {{ d.created_at|date:"Y-m-d H:i" }}
              {% else %}
                â€”
              {% endif %}
            </div>
          </div>
        {% empty %}
          <div class="text-center text-muted" style="padding: 2rem;">
            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø²Ø§Ø¹Ø§Øª Ø­Ø¯ÙŠØ«Ø©
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="profile-section" style="margin-bottom: 2rem;">
    <div class="data-card-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h3 class="card-section-title">ğŸ’³ Ø¢Ø®Ø± Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
      {% if urls.invoices or inv_list_url %}
        <a href="{{ urls.invoices|default:inv_list_url }}" class="btn btn-outline btn-sm">
          Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        </a>
      {% endif %}
    </div>
    
    <div class="table-wrapper">
      <table class="table table-clean">
        <thead>
          <tr>
            <th>#</th>
            <th>Ø§Ù„Ø·Ù„Ø¨/Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ©</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          </tr>
        </thead>
        <tbody>
          {% for inv in inv_recent|slice:":5" %}
            <tr>
              <td class="text-muted">#{{ inv.id }}</td>
              <td>
                {% if inv.agreement and inv.agreement.request %}
                  Ø·Ù„Ø¨ #{{ inv.agreement.request.id }}
                {% elif inv.agreement %}
                  Ø§ØªÙØ§Ù‚ÙŠØ© #{{ inv.agreement.id }}
                {% else %}
                  â€”
                {% endif %}
              </td>
              <td style="font-weight: 700; color: var(--primary-600);">
                {% if inv.client_total %}
                  {{ inv.client_total|floatformat:2|intcomma }}
                {% elif inv.total_amount %}
                  {{ inv.total_amount|floatformat:2|intcomma }}
                {% elif inv.gross_amount %}
                  {{ inv.gross_amount|floatformat:2|intcomma }}
                {% elif inv.amount %}
                  {{ inv.amount|floatformat:2|intcomma }}
                {% else %}
                  0.00
                {% endif %}
                Ø±.Ø³
              </td>
              <td>
                {% if inv.status %}
                  <span class="badge 
                    {% if inv.status == 'paid' or inv.is_paid %}badge-verified
                    {% else %}badge-pending{% endif %}">
                    {{ inv.status }}
                  </span>
                {% else %}
                  <span class="badge badge-default">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                {% endif %}
              </td>
              <td class="text-muted">
                {% if inv.issued_at %}
                  {{ inv.issued_at|date:"Y-m-d" }}
                {% elif inv.created_at %}
                  {{ inv.created_at|date:"Y-m-d" }}
                {% else %}
                  â€”
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="5" class="text-center text-muted" style="padding: 2rem;">
                Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ø­Ø¯ÙŠØ«Ø©
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="section-header" style="margin-bottom: 1rem;">
    <h3 class="section-title">âš¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
    <p class="section-description">Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
  </div>

  <div class="quick-links-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
    {% for ql in quick %}
      {% if ql.url %}
        <a href="{{ ql.url }}" class="quick-link profile-section text-center">
          <div class="quick-icon" style="font-size: 2rem; margin-bottom: 0.75rem;">
            {% if ql.icon == 'fa-receipt' %}ğŸ§¾
            {% elif ql.icon == 'fa-list' %}ğŸ“‹
            {% elif ql.icon == 'fa-file-signature' %}ğŸ“
            {% elif ql.icon == 'fa-scale-balanced' %}âš–ï¸
            {% elif ql.icon == 'fa-users' %}ğŸ‘¥
            {% else %}âš¡{% endif %}
          </div>
          <div class="quick-text" style="font-weight: 600; color: var(--dark-700); font-size: 0.9rem;">
            {{ ql.label }}
          </div>
        </a>
      {% endif %}
    {% endfor %}
  </div>

</div>
{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script>
  (function () {
    document.querySelectorAll('.kpi-card, .quick-link').forEach(function (card) {
      card.addEventListener('mouseenter', function () {
        this.style.transform = 'translateY(-5px)';
        this.style.boxShadow = 'var(--shadow-lg)';
      });
      card.addEventListener('mouseleave', function () {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '';
      });
    });

    document.querySelectorAll('.btn').forEach(function (button) {
      button.addEventListener('click', function () {
        if (typeof animateButtonClick === 'function') {
          animateButtonClick(this);
        }
      });
    });

    document.querySelectorAll('.table-clean tbody tr').forEach(function (row) {
      row.addEventListener('mouseenter', function () {
        this.style.background = 'var(--primary-50)';
      });
      
      row.addEventListener('mouseleave', function () {
        this.style.background = '';
      });
    });

    // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ÙˆØ­Ø© ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
    setInterval(function() {
      fetch(window.location.href)
        .then(response => response.text())
        .then(html => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const newContent = doc.querySelector('.admin-dashboard');
          if (newContent) {
            document.querySelector('.admin-dashboard').innerHTML = newContent.innerHTML;
          }
        })
        .catch(error => console.log('Auto-refresh failed:', error));
    }, 30000);
  })();
  </script>

  <style>
  .admin-dashboard .admin-header-content {
    padding: 2rem;
  }

  .admin-dashboard .kpi-card {
    transition: all 0.3s ease;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .admin-dashboard .quick-link {
    transition: all 0.3s ease;
    text-decoration: none;
    padding: 1.5rem 1rem;
    border-radius: var(--radius-xl);
  }

  .admin-dashboard .quick-link:hover {
    text-decoration: none;
    background: var(--primary-50);
  }

  .admin-dashboard .table-wrapper {
    overflow-x: auto;
    border-radius: var(--radius-lg);
    border: 1px solid var(--dark-200);
  }

  .admin-dashboard .table-clean {
    width: 100%;
    border-collapse: collapse;
  }

  .admin-dashboard .table-clean th {
    background: var(--dark-50);
    color: var(--dark-700);
    font-weight: 600;
    padding: 1rem;
    text-align: right;
    border-bottom: 1px solid var(--dark-200);
  }

  .admin-dashboard .table-clean td {
    padding: 1rem;
    border-bottom: 1px solid var(--dark-100);
    vertical-align: top;
  }

  .admin-dashboard .table-clean tr:last-child td {
    border-bottom: none;
  }

  .admin-dashboard .text-muted {
    color: var(--dark-500);
  }

  .admin-dashboard .text-center {
    text-align: center;
  }

  .admin-dashboard .finance-grid .profile-section {
    padding: 1.5rem 1rem;
  }

  .admin-dashboard .finance-value {
    font-size: 1.5rem;
    font-weight: 700;
  }

  @media (max-width: 1024px) {
    .admin-dashboard .tables-grid {
      grid-template-columns: 1fr;
    }
    
    .admin-dashboard .kpi-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .admin-dashboard .admin-meta {
      width: 100%;
    }
    
    .admin-dashboard .kpi-grid {
      grid-template-columns: 1fr;
    }
    
    .admin-dashboard .finance-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .admin-dashboard .quick-links-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 480px) {
    .admin-dashboard .finance-grid {
      grid-template-columns: 1fr;
    }
    
    .admin-dashboard .quick-links-grid {
      grid-template-columns: 1fr;
    }
    
    .admin-dashboard .table-wrapper {
      font-size: 0.875rem;
    }
  }

  .admin-dashboard .kpi-value {
    animation: countUp 0.8s ease-out;
  }

  @keyframes countUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  </style>
{% endblock %}