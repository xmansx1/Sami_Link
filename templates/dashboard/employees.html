{% extends "base.html" %}
{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†{% endblock %}
{% block content %}

<section class="page-section employees-management">
  <div class="container">
    
    {# ===== Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© ===== #}
    <div class="section-header" style="text-align: right; margin-bottom: 2rem;">
      <div class="section-badge">
        ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
      </div>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
        <h1 class="section-title" style="margin: 0;">
          Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        </h1>
        <div class="page-subtitle" style="color: var(--dark-500); font-size: 0.95rem;">
          Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        </div>
      </div>
    </div>

    {# ===== ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø« ===== #}
    <div class="profile-section" style="margin-bottom: 2rem;">
      <form method="get" class="search-form">
        <div class="form-grid-3" style="display: grid; grid-template-columns: 1fr auto auto; gap: 1rem;">
          <div class="form-field">
            <input class="input" 
                   type="text" 
                   name="q" 
                   value="{{ q }}" 
                   placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯â€¦"
                   style="width: 100%;">
          </div>
          <button class="btn btn-primary">
            Ø¨Ø­Ø«
          </button>
          <a href="." class="btn btn-outline">
            ğŸ”„ ØªØµÙÙŠØ±
          </a>
        </div>
      </form>
    </div>

    {# ===== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ===== #}
    <div class="profile-section">
      <div class="table-wrapper">
        <table class="table table-clean">
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
              <th>Ø§Ù„Ø¯ÙˆØ±</th>
              <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</th>
              <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
            {% for u in page_obj %}
            <tr class="scroll-reveal">
              <td class="text-muted">#{{ u.id }}</td>
              
              <td>
                <div class="employee-info">
                  <div class="employee-name">
                    {% if u.name %}
                      {{ u.name }}
                    {% else %}
                      {% if u.get_full_name %}
                        {{ u.get_full_name }}
                      {% else %}
                        {{ u.username }}
                      {% endif %}
                    {% endif %}
                  </div>
                </div>
              </td>
              
              <td>
                <div class="email-info">
                  <span class="email-text">{{ u.email }}</span>
                </div>
              </td>
              
              <td>
                <span class="badge 
                           {% if u.role == 'admin' %}badge-verified
                           {% elif u.role == 'employee' or u.role == 'tech' %}badge-pending
                           {% elif u.role == 'finance' %}badge-default
                           {% else %}badge-rejected{% endif %}">
                  {% if u.role %}
                    {% if u.role == 'admin' %}Ù…Ø¯ÙŠØ±
                    {% elif u.role == 'employee' or u.role == 'tech' %}Ù…ÙˆØ¸Ù
                    {% elif u.role == 'finance' %}Ù…Ø§Ù„ÙŠ
                    {% elif u.role == 'client' %}Ø¹Ù…ÙŠÙ„
                    {% else %}{{ u.role }}{% endif %}
                  {% else %}
                    -
                  {% endif %}
                </span>
              </td>
              
              <td class="text-muted">
                {% if u.date_joined %}
                  {{ u.date_joined|date:"Y-m-d" }}
                {% else %}
                  -
                {% endif %}
              </td>
              
              <td>
                <div class="table-actions">
                  <a href="{% url 'admin:accounts_user_change' u.id %}" 
                     class="btn btn-outline btn-sm"
                     title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù">
                    âœï¸ ØªØ­Ø±ÙŠØ±
                  </a>
                  <a href="{% url 'admin:accounts_user_delete' u.id %}" 
                     class="btn btn-danger btn-sm"
                     title="Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù"
                     onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸ÙØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.');">
                    ğŸ—‘ï¸ Ø­Ø°Ù
                  </a>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center text-muted" style="padding: 3rem;">
                <div class="empty-state">
                  <div class="empty-icon" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">ğŸ‘¥</div>
                  <h3 class="card-section-title" style="margin-bottom: 0.5rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h3>
                  <p class="card-section-note">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙˆØ¸ÙÙŠÙ† Ù…Ø·Ø§Ø¨Ù‚ÙŠÙ† Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    {# ===== ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª ===== #}
    {% if page_obj %}
    <div class="pagination profile-section" style="text-align: center; padding: 1.5rem;">
      <div class="pagination-inner employee-actions">
        {% if page_obj.has_previous %}
          <a class="btn btn-outline btn-sm"
             href="?page={{ page_obj.previous_page_number }}&q={{ q }}">
            â€¹ Ø§Ù„Ø³Ø§Ø¨Ù‚
          </a>
        {% else %}
          <span class="btn btn-outline btn-sm" style="opacity: 0.5; cursor: not-allowed;">â€¹ Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
        {% endif %}

        <span class="pagination-info badge badge-default">
          ØµÙØ­Ø© {{ page_obj.number }} Ù…Ù† {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
          <a class="btn btn-outline btn-sm"
             href="?page={{ page_obj.next_page_number }}&q={{ q }}">
            Ø§Ù„ØªØ§Ù„ÙŠ â€º
          </a>
        {% else %}
          <span class="btn btn-outline btn-sm" style="opacity: 0.5; cursor: not-allowed;">Ø§Ù„ØªØ§Ù„ÙŠ â€º</span>
        {% endif %}
      </div>
    </div>
    {% endif %}

    {# ===== Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© ===== #}

  </div>
</section>

{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script>
  (function () {
    // ØªÙ‡ÙŠØ¦Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ±
    if (typeof initScrollReveal === 'function') {
      initScrollReveal();
    }

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.querySelectorAll('.btn').forEach(button => {
      button.addEventListener('click', function() {
        if (typeof animateButtonClick === 'function') {
          animateButtonClick(this);
        }
      });
    });

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    document.querySelectorAll('.table-clean tbody tr').forEach(row => {
      row.addEventListener('mouseenter', function() {
        this.style.background = 'var(--primary-50)';
        this.style.transform = 'translateX(-5px)';
      });
      
      row.addEventListener('mouseleave', function() {
        this.style.background = '';
        this.style.transform = 'translateX(0)';
      });

      // ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ±
      const actions = this.querySelector('.table-actions');
      if (actions) {
        row.addEventListener('mouseenter', function() {
          actions.style.opacity = '1';
        });
        
        row.addEventListener('mouseleave', function() {
          actions.style.opacity = '0.9';
        });
      }
    });

    // ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¨Ø­Ø«
    const searchForm = document.querySelector('.search-form');
    const searchInput = searchForm?.querySelector('input[name="q"]');
    
    if (searchInput) {
      searchInput.addEventListener('focus', function() {
        this.style.borderColor = 'var(--primary-500)';
        this.style.boxShadow = '0 0 0 3px rgba(34, 197, 94, 0.1)';
      });
      
      searchInput.addEventListener('blur', function() {
        this.style.borderColor = '';
        this.style.boxShadow = '';
      });

      // Ø¨Ø­Ø« Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
      searchInput.addEventListener('input', function() {
        if (this.value.length > 2) {
          this.style.background = 'var(--primary-50)';
        } else {
          this.style.background = '';
        }
      });
    }

    // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù Ø¨Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„
    document.querySelectorAll('a[href*="delete"]').forEach(link => {
      link.addEventListener('click', function(e) {
        const row = this.closest('tr');
        const userName = row?.querySelector('.employee-name')?.textContent?.trim();
        const userEmail = row?.querySelector('.email-text')?.textContent?.trim();
        
        if (userName || userEmail) {
          const message = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù:\n${userName ? 'Ø§Ù„Ø§Ø³Ù…: ' + userName : ''}\n${userEmail ? 'Ø§Ù„Ø¨Ø±ÙŠØ¯: ' + userEmail : ''}\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`;
          
          if (!confirm(message)) {
            e.preventDefault();
            return false;
          }
        }
      });
    });

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ø¯Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
    document.querySelectorAll('.badge').forEach(badge => {
      badge.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.05)';
      });
      
      badge.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1)';
      });
    });

  })();
  </script>

  <style>
  .employees-management .form-grid-3 {
    grid-template-columns: 1fr auto auto;
  }

  .employees-management .table-wrapper {
    overflow-x: auto;
    border-radius: var(--radius-xl);
    border: 1px solid var(--dark-200);
  }

  .employees-management .table-clean {
    width: 100%;
    border-collapse: collapse;
  }

  .employees-management .table-clean th {
    background: var(--dark-50);
    color: var(--dark-700);
    font-weight: 600;
    padding: 1rem;
    text-align: right;
    border-bottom: 1px solid var(--dark-200);
  }

  .employees-management .table-clean td {
    padding: 1rem;
    border-bottom: 1px solid var(--dark-100);
    vertical-align: middle;
    transition: all 0.3s ease;
  }

  .employees-management .table-clean tr:last-child td {
    border-bottom: none;
  }

  .employees-management .employee-info {
    min-width: 150px;
  }

  .employees-management .employee-name {
    font-weight: 600;
    color: var(--dark-900);
  }

  .employees-management .email-info {
    min-width: 200px;
  }

  .employees-management .email-text {
    color: var(--dark-700);
    direction: ltr;
    text-align: right;
    display: inline-block;
  }

  .employees-management .table-actions {
    display: flex;
    gap: 0.5rem;
    opacity: 0.9;
    transition: opacity 0.3s ease;
  }

  .employees-management .text-muted {
    color: var(--dark-500);
  }

  .employees-management .text-center {
    text-align: center;
  }

  .employees-management .empty-state {
    padding: 2rem;
  }

  .employees-management .empty-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
  }

  .employees-management .pagination-inner {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
  }

  .employees-management .pagination-info {
    padding: 0.5rem 1rem;
  }

  .employees-management .quick-stats {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }

  .employees-management .stat-item {
    text-align: center;
    padding: 1rem;
    background: var(--white);
    border-radius: var(--radius-lg);
    border: 1px solid var(--dark-200);
  }

  .employees-management .stat-label {
    font-size: 0.875rem;
    color: var(--dark-600);
    margin-bottom: 0.5rem;
  }

  .employees-management .stat-number {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-600);
  }

  @media (max-width: 768px) {
    .employees-management .form-grid-3 {
      grid-template-columns: 1fr;
    }
    
    .employees-management .table-actions {
      flex-direction: column;
    }
    
    .employees-management .table-actions .btn {
      width: 100%;
    }
    
    .employees-management .pagination-inner {
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .employees-management .quick-stats {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 480px) {
    .employees-management .quick-stats {
      grid-template-columns: 1fr;
    }
    
    .employees-management .table-clean {
      font-size: 0.875rem;
    }
    
    .employees-management .table-clean th,
    .employees-management .table-clean td {
      padding: 0.75rem 0.5rem;
    }
  }

  /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .employees-management .scroll-reveal {
    animation: fadeIn 0.6s ease-out;
  }

  /* ØªØ®ØµÙŠØµ Ø§Ù„Ø¨Ø§Ø¯Ø¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ± */
  .employees-management .badge-verified {
    background: var(--primary-100);
    color: var(--primary-700);
    border: 1px solid var(--primary-200);
  }

  .employees-management .badge-pending {
    background: var(--secondary-100);
    color: var(--secondary-700);
    border: 1px solid var(--secondary-200);
  }

  .employees-management .badge-default {
    background: var(--dark-100);
    color: var(--dark-700);
    border: 1px solid var(--dark-200);
  }

  .employees-management .badge-rejected {
    background: #fef2f2;
    color: #dc2626;
    border: 1px solid #fecaca;
  }
  </style>
{% endblock %}