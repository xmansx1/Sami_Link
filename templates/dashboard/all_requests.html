{# dashboard/templates/dashboard/all_requests.html #}
{% extends "dashboard/base_admin.html" %}

{% block title %}Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª{% endblock %}

{# Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© #}
{% block page_header %}
<div class="profile-section" style="margin-bottom: 1.25rem;">
  <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:1rem;flex-wrap:wrap;">
    <div>
      <div class="section-badge" style="margin-bottom:.5rem;">
        ğŸ§¾ Ø¹Ø±Ø¶ Ø´Ø§Ù…Ù„ Ù„ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
      </div>
      <h1 class="section-title" style="margin:0 0 .25rem;">
        Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù†ØµÙ‘Ø©
      </h1>
      <p class="section-description" style="margin:0;color:var(--dark-500);font-size:.9rem;">
        ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ù† Ù‡Ù†Ø§ Ù…ØªØ§Ø¨Ø¹Ø© ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨ØºØ¶Ù‘ Ø§Ù„Ù†Ø¸Ø± Ø¹Ù† Ø­Ø§Ù„ØªÙ‡Ø§ Ø£Ùˆ Ù…Ø§Ù„ÙƒÙ‡Ø§ØŒ Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹.
      </p>
    </div>

    <div class="profile-section" style="min-width:210px;text-align:center;padding:.75rem 1rem;">
      <div style="font-size:.85rem;color:var(--dark-500);margin-bottom:.25rem;">ğŸ“† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…</div>
      <div style="font-weight:800;font-size:1.1rem;color:var(--dark-800);">
        {{ today|default:None|date:"Y-m-d" }}
      </div>
      {% if page_obj %}
        <div style="margin-top:.4rem;font-size:.85rem;color:var(--dark-500);">
          Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <strong>{{ page_obj.paginator.count }}</strong> Ø·Ù„Ø¨
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="profile-section">

  {# Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø­Ø« #}
  <form method="get" class="fade-in" style="margin-bottom:1rem;">
    <div style="display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;">
      <input
        type="text"
        name="q"
        value="{{ q }}"
        placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„..."
        class="input"
        style="min-width:230px;max-width:320px;flex:1 1 220px;"
      >
      <button class="btn btn-blue" type="submit">
        ğŸ” Ø¨Ø­Ø«
      </button>
      {% if q %}
        <a href="{% url 'dashboard:all_requests' %}" class="btn btn-gray">
          Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
        </a>
      {% endif %}
    </div>
  </form>

  {# Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª #}
  <div class="table-wrapper">
    <table class="table table-clean">
      <thead>
        <tr>
          <th style="width:70px;">#</th>
          <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
          <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th style="width:180px;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th style="width:80px;text-align:center;">Ø¹Ø±Ø¶</th>
        </tr>
      </thead>
      <tbody>
        {% for r in page_obj %}
          <tr class="scroll-reveal">
            <td class="text-muted">#{{ r.id }}</td>

            <td>
              <div style="font-weight:600;">
                {{ r.title|default:"â€”" }}
              </div>
            </td>

            <td>
              {% if r.client %}
                {% if r.client.name %}
                  {{ r.client.name }}
                {% elif r.client.phone %}
                  {{ r.client.phone }}
                {% elif r.client.email %}
                  {{ r.client.email }}
                {% else %}
                  {{ r.client }}
                {% endif %}
              {% else %}
                â€”
              {% endif %}
            </td>

            <td>
              {% if r.status %}
                <span class="badge">{{ r.status }}</span>
              {% elif r.state %}
                <span class="badge">{{ r.state }}</span>
              {% else %}
                <span class="badge">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
              {% endif %}
            </td>

            <td class="text-muted">
              {% if r.created_at %}
                {{ r.created_at|date:"Y-m-d H:i" }}
              {% elif r.submitted_at %}
                {{ r.submitted_at|date:"Y-m-d H:i" }}
              {% else %}
                â€”
              {% endif %}
            </td>

            <td style="text-align:center;">
              <a
                href="{% url 'marketplace:request_detail' r.id %}"
                class="btn btn-xs btn-gray"
                title="Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨"
              >
                ğŸ‘ï¸
              </a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted" style="padding:2rem;">
              Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {# Ø§Ù„ØªØ±Ù‚ÙŠÙ… #}
  {% if page_obj %}
    <div style="margin-top:1rem;display:flex;flex-wrap:wrap;gap:.75rem;align-items:center;justify-content:space-between;">
      <div class="text-muted" style="font-size:.9rem;">
        ØµÙØ­Ø© {{ page_obj.number }} Ù…Ù† {{ page_obj.paginator.num_pages }}
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:.5rem;">
        {% if page_obj.has_previous %}
          <a
            href="?q={{ q }}&page={{ page_obj.previous_page_number }}"
            class="btn btn-gray btn-sm"
          >
            Ø§Ù„Ø³Ø§Ø¨Ù‚
          </a>
        {% endif %}
        {% if page_obj.has_next %}
          <a
            href="?q={{ q }}&page={{ page_obj.next_page_number }}"
            class="btn btn-gray btn-sm"
          >
            Ø§Ù„ØªØ§Ù„ÙŠ
          </a>
        {% endif %}
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}
