{# marketplace/templates/marketplace/admin_request_reassign.html #}
{% extends "base.html" %}
{% block title %}Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø³Ù†Ø§Ø¯ Ø·Ù„Ø¨ #{{ req.pk }}{% endblock %}

{% block content %}
<section class="page-section reassign-page">
  <div class="container">
    <div class="reassign-card profile-section" style="max-width: 800px; margin: 0 auto;">
      
      {# ===== Ø±Ø£Ø³ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ===== #}
      <div class="card-header" style="background: linear-gradient(135deg, var(--primary-50) 0%, var(--secondary-50) 100%); border-bottom: 1px solid var(--dark-200); padding: 2rem;">
        <div class="header-content" style="display: flex; align-items: flex-start; justify-content: space-between; gap: 1.5rem;">
          <div style="flex: 1;">
            <div class="section-badge" style="margin-bottom: 1rem;">
              ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø³Ù†Ø§Ø¯ Ø·Ù„Ø¨
            </div>
            <h1 class="section-title" style="margin-bottom: 0.5rem; font-size: 1.75rem;">
              Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø³Ù†Ø§Ø¯ Ø·Ù„Ø¨ #{{ req.pk }}
            </h1>
            <div class="request-info" style="display: flex; flex-direction: column; gap: 0.5rem;">
              <p class="card-section-note">
                <strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> {{ req.title|default:"â€”" }}
              </p>
              <p class="card-section-note">
                <strong>Ø§Ù„Ù…ÙØ¹ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> {{ req.assigned_employee|default:"ØºÙŠØ± Ù…Ø¹ÙŠÙ‘Ù†" }}
              </p>
            </div>
          </div>
          <a href="{{ req.get_absolute_url }}" class="btn btn-outline">
            â†©ï¸ Ø±Ø¬ÙˆØ¹
          </a>
        </div>

        {# ===== ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø¯Ø§Ø±ÙŠ ===== #}
        <div class="admin-alert profile-section" style="background: var(--secondary-50); border-color: var(--secondary-200); margin-top: 1.5rem;">
          <div class="card-row" style="display: flex; align-items: flex-start; gap: 1rem;">
            <span class="alert-icon" style="color: var(--secondary-600); font-size: 1.2rem;">âš ï¸</span>
            <div class="alert-content">
              <div class="card-section-title" style="color: var(--secondary-700); margin-bottom: 0.25rem;">
                ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø¯Ø§Ø±ÙŠ
              </div>
              <p class="card-section-note" style="color: var(--secondary-600);">
                Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ Ù‚Ø¯ ØªØºÙŠÙ‘Ø± ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ§Ù„Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø·Ù„Ø¨. ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ÙÙŠ Ø³Ø¬Ù„Ù‘ Ø§Ù„Ù†Ø¸Ø§Ù….
              </p>
            </div>
          </div>
        </div>
      </div>

      {# ===== Ø¬Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ===== #}
      <div class="card-body" style="padding: 2rem;">
        
        {# ===== Ø£Ø®Ø·Ø§Ø¡ Ø¹Ø§Ù…Ø© ===== #}
        {% if form.non_field_errors %}
          <div class="error-alert profile-section" style="background: #fef2f2; border-color: #fecaca; margin-bottom: 1.5rem;">
            <div class="card-row" style="display: flex; align-items: flex-start; gap: 1rem;">
              <span class="error-icon" style="color: #ef4444; font-size: 1.2rem;">âŒ</span>
              <div class="error-content">
                <div class="card-section-title" style="color: #dc2626; margin-bottom: 0.25rem;">
                  Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
                </div>
                <p class="card-section-note" style="color: #b91c1c;">
                  {{ form.non_field_errors }}
                </p>
              </div>
            </div>
          </div>
        {% endif %}

        <form id="reassignForm" method="post" class="reassign-form" novalidate>
          {% csrf_token %}

          {# Ø£ÙŠ Ø­Ù‚ÙˆÙ„ Ù…Ø®ÙÙŠØ© #}
          {% for hf in form.hidden_fields %}
            {{ hf }}
          {% endfor %}

          {# ===== Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù ===== #}
          <div class="form-field">
            <label for="{{ form.employee.id_for_label }}" class="form-label">
              ğŸ‘¥ Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù
            </label>
            <div class="select-wrapper">
              {{ form.employee }}
            </div>
            {% if form.employee.errors %}
              <div class="field-error">
                {{ form.employee.errors|join:", " }}
              </div>
            {% endif %}
            <p class="field-hint">
              ÙŠÙÙ†ØµØ­ Ø¨Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù…ÙˆØ¸Ù Ù…Ù†Ø§Ø³Ø¨ Ù„Ù…Ø¬Ø§Ù„Ù‡ Ù„Ø¶Ù…Ø§Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°.
            </p>
          </div>

          {# ===== Ø­Ù‚Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© ===== #}
          {% if form.note %}
          <div class="form-field">
            <label for="{{ form.note.id_for_label }}" class="form-label">
              ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            </label>
            <div class="textarea-wrapper">
              {{ form.note }}
            </div>
            {% if form.note.errors %}
              <div class="field-error">
                {{ form.note.errors|join:", " }}
              </div>
            {% endif %}
            <p class="field-hint">
              Ø³ØªØ¸Ù‡Ø± Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© ÙÙŠ Ø³Ø¬Ù„Ù‘ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§.
            </p>
          </div>
          {% endif %}

          {# ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ===== #}
          <div class="form-actions employee-actions" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--dark-200);">
            <button id="submitBtn" type="submit" name="action" value="reassign"
                    class="btn btn-primary">
              ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
            </button>
            <a class="btn btn-outline"
               href="{{ req.get_absolute_url }}">
              ğŸš« Ø¥Ù„ØºØ§Ø¡
            </a>
          </div>
        </form>
      </div>
    </div>

    {# ===== Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© ===== #}
    <div class="info-section profile-section" style="max-width: 800px; margin: 1.5rem auto 0; background: var(--dark-50);">
      <div class="card-section-title">ğŸ’¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø©</div>
      <div class="info-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div class="info-item">
          <div class="info-icon">ğŸ“‹</div>
          <div class="info-content">
            <div class="info-title">Ø§Ù„Ø³Ø¬Ù„</div>
            <div class="info-text">Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
          </div>
        </div>
        <div class="info-item">
          <div class="info-icon">ğŸ””</div>
          <div class="info-content">
            <div class="info-title">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
            <div class="info-text">Ø³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø§Ù„ØªØºÙŠÙŠØ±</div>
          </div>
        </div>
        <div class="info-item">
          <div class="info-icon">âš¡</div>
          <div class="info-content">
            <div class="info-title">Ø§Ù„ÙÙˆØ±ÙŠØ©</div>
            <div class="info-text">Ø§Ù„ØªØºÙŠÙŠØ± Ø³Ø§Ø±ÙŠ Ø§Ù„Ù…ÙØ¹ÙˆÙ„ ÙÙˆØ± Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>
{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script>
  (function () {
    // ØªÙ‡ÙŠØ¦Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ±
    if (typeof initScrollReveal === 'function') {
      initScrollReveal();
    }

    // ØªÙ‡ÙŠØ¦Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    if (typeof initButtonEffects === 'function') {
      initButtonEffects();
    }

    var form = document.getElementById('reassignForm');
    var submitBtn = document.getElementById('submitBtn');
    var employeeSelect = document.querySelector('select[name="employee"]');

    // ØªØ£ÙƒÙŠØ¯ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    function confirmReassign() {
      const selectedEmployee = employeeSelect ? employeeSelect.options[employeeSelect.selectedIndex] : null;
      const employeeName = selectedEmployee ? selectedEmployee.text : '';
      
      let msg = 'Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø³Ù†Ø§Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù…ÙˆØ¸Ù Ø¢Ø®Ø±.\n';
      if (employeeName) {
        msg += `Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${employeeName}\n`;
      }
      msg += 'Ø³ÙŠÙØ³Ø¬Ù‘ÙÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ù‘.\nÙ…ØªØ§Ø¨Ø¹Ø©ØŸ';
      
      return window.confirm(msg);
    }

    if (form) {
      // Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ØªÙƒØ±Ø±
      form.addEventListener('submit', function (e) {
        if (!confirmReassign()) {
          e.preventDefault();
          return false;
        }

        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
          
          // ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ù‚Ø±
          if (typeof animateButtonClick === 'function') {
            animateButtonClick(submitBtn);
          }
        }

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ³Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ù‹Ø§
        if (typeof showToast === 'function') {
          showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø·Ù„Ø¨...', 'info');
        }
      });

      // ØªØ±ÙƒÙŠØ² ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ù…ÙˆØ¸Ù
      if (employeeSelect) {
        setTimeout(function () { 
          employeeSelect.focus();
          employeeSelect.style.borderColor = 'var(--primary-500)';
          employeeSelect.style.boxShadow = '0 0 0 3px rgba(34, 197, 94, 0.1)';
          
          setTimeout(() => {
            employeeSelect.style.borderColor = '';
            employeeSelect.style.boxShadow = '';
          }, 1500);
        }, 100);
      }

      // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚ÙˆÙ„
      const formFields = form.querySelectorAll('select, textarea');
      formFields.forEach(field => {
        field.addEventListener('focus', function() {
          this.style.borderColor = 'var(--primary-500)';
          this.style.boxShadow = '0 0 0 3px rgba(34, 197, 94, 0.1)';
        });
        
        field.addEventListener('blur', function() {
          this.style.borderColor = '';
          this.style.boxShadow = '';
        });

        // ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
        if (field.tagName === 'SELECT') {
          field.addEventListener('change', function() {
            this.style.background = 'var(--primary-50)';
            setTimeout(() => {
              this.style.background = '';
            }, 500);
          });
        }
      });
    }

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
    document.querySelectorAll('.info-item').forEach((item, index) => {
      item.style.animationDelay = `${index * 0.2}s`;
      item.classList.add('scroll-reveal');
    });

  })();
  </script>

  <style>
  .reassign-page .reassign-card {
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
  }

  .reassign-page .form-field {
    margin-bottom: 2rem;
  }

  .reassign-page .form-label {
    display: block;
    font-weight: 600;
    color: var(--dark-700);
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
  }

  .reassign-page select,
  .reassign-page textarea {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--dark-300);
    border-radius: var(--radius-lg);
    background: var(--white);
    font-family: inherit;
    font-size: 1rem;
    transition: var(--transition);
  }

  .reassign-page select:focus,
  .reassign-page textarea:focus {
    outline: none;
    border-color: var(--primary-500);
    box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
  }

  .reassign-page textarea {
    min-height: 100px;
    resize: vertical;
  }

  .reassign-page .field-error {
    color: #ef4444;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  .reassign-page .field-hint {
    color: var(--dark-500);
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  .reassign-page .info-grid {
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }

  .reassign-page .info-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    background: var(--white);
    border-radius: var(--radius-lg);
    border: 1px solid var(--dark-200);
  }

  .reassign-page .info-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .reassign-page .info-content {
    flex: 1;
  }

  .reassign-page .info-title {
    font-weight: 600;
    color: var(--dark-700);
    margin-bottom: 0.25rem;
  }

  .reassign-page .info-text {
    color: var(--dark-600);
    font-size: 0.875rem;
    line-height: 1.4;
  }

  .reassign-page .form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-start;
  }

  @media (max-width: 768px) {
    .reassign-page .header-content {
      flex-direction: column;
      align-items: stretch;
    }
    
    .reassign-page .header-content .btn {
      align-self: flex-end;
    }
    
    .reassign-page .form-actions {
      flex-direction: column;
    }
    
    .reassign-page .form-actions .btn {
      width: 100%;
    }
    
    .reassign-page .info-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .reassign-page .card-header,
    .reassign-page .card-body {
      padding: 1.5rem;
    }
    
    .reassign-page .section-title {
      font-size: 1.5rem;
    }
  }

  /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ© */
  .reassign-page .admin-alert,
  .reassign-page .error-alert {
    border-left: 4px solid;
  }

  .reassign-page .admin-alert {
    border-left-color: var(--secondary-500);
  }

  .reassign-page .error-alert {
    border-left-color: #ef4444;
  }

  /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© */
  @keyframes slideInFromTop {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .reassign-page .reassign-card {
    animation: slideInFromTop 0.6s ease-out;
  }
  </style>
{% endblock %}