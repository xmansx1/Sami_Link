{% extends "dashboard/base_admin.html" %}
{% load humanize %}

{% block title %}ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª | Ø³Ø§Ù…ÙŠ Ù„ÙŠÙ†Ùƒ{% endblock %}

{% block page_header %}
<div class="dashboard-header">
  <div class="header-content">
    <div class="welcome-section">
      <div class="badge-pill">
        <span class="pulse-dot"></span>
        Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©
      </div>
      <h1 class="welcome-title">
        ØªØ£ÙƒÙŠØ¯ ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
      </h1>
      <p class="welcome-subtitle">
        Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø­ÙˆØ§Ù„Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ù„Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©.
      </p>
    </div>

    <div class="header-stats">
      <div class="stat-pill">
        <span class="stat-icon">ğŸ“¥</span>
        <div class="stat-info">
          <span class="stat-label">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯</span>
          <span class="stat-value">{{ invoices|length|default:0 }} Ø­ÙˆØ§Ù„Ø©</span>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="dashboard-container">

  {# --- Transfers Table --- #}
  <div class="section-container fade-in-up">
    <div class="card-shadow table-card">
        <table class="modern-table">
            <thead>
                <tr>
                    <th width="100">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                    <th>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø±Ø¬Ø¹</th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚</th>
                    <th>Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø¨Ù†ÙƒÙŠ</th>
                    <th width="200">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                {% for inv in invoices %}
                <tr>
                    <td>
                        <div class="font-weight-bold text-main">#{{ inv.id }}</div>
                    </td>
                    <td>
                        <div class="table-main-text">
                            {% if inv.agreement %}
                                Ø§ØªÙØ§Ù‚ÙŠØ© A{{ inv.agreement_id }}
                            {% else %}
                                â€”
                            {% endif %}
                        </div>
                        {% if inv.agreement and inv.agreement.request_id %}
                        <div class="table-sub-text">
                            Ø·Ù„Ø¨ Ø±Ù‚Ù… R{{ inv.agreement.request_id }}
                        </div>
                        {% endif %}
                    </td>
                    <td>
                        <div class="amount-cell">
                            {{ inv.amount|default:inv.client_total_amount|floatformat:2|intcomma }}
                            <small>Ø±.Ø³</small>
                        </div>
                    </td>
                    <td>
                        {% if inv.paid_ref %}
                        <div class="ref-badge">
                            <span class="ref-icon">ğŸ¦</span>
                            {{ inv.paid_ref }}
                        </div>
                        {% else %}
                        <span class="text-muted text-sm">â€”</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="actions-row">
                            <form method="post" action="{% url 'finance:mark_invoice_paid' inv.id %}" class="d-inline">
                                {% csrf_token %}
                                <input type="hidden" name="method" value="bank">
                                <input type="hidden" name="ref_code" value="{{ inv.ref_code }}">
                                <input type="hidden" name="paid_ref" value="{{ inv.paid_ref }}">
                                <button type="submit" class="btn-action success" title="ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…">
                                    âœ… ØªØ£ÙƒÙŠØ¯
                                </button>
                            </form>
                            
                            <a href="{% url 'finance:invoice_detail' inv.id %}" class="btn-action outline" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                ğŸ‘ï¸ ØªÙØ§ØµÙŠÙ„
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="empty-state">
                        <div class="empty-content">
                            <span class="empty-icon">ğŸ‰</span>
                            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­ÙˆÙŠÙ„Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</h3>
                            <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§.</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
  </div>

</div>
{% endblock %}

{% block extra_scripts %}
<style>
    /* --- Reusing Dashboard Variables --- */
    :root {
        --dash-bg: #f8fafc;
        --card-bg: #ffffff;
        --primary-soft: #f0fdf4;
        --primary-strong: #16a34a;
        --text-main: #1e293b;
        --text-sub: #64748b;
        --border-light: #e2e8f0;
        --shadow-card: 0 4px 6px -1px rgb(0 0 0 / 0.05);
        --radius-card: 16px;
    }

    /* Layout */
    .dashboard-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1.5rem;
        font-family: 'Tajawal', sans-serif;
        color: var(--text-main);
    }

    /* Header */
    .dashboard-header {
        background: linear-gradient(120deg, #ffffff 0%, #f0fdf4 100%);
        padding: 2rem 1.5rem;
        border-bottom: 1px solid var(--border-light);
        margin-bottom: 2rem;
    }
    .header-content {
        max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: flex-end; flex-wrap: wrap; gap: 1.5rem;
    }
    .badge-pill {
        display: inline-flex; align-items: center; gap: 0.5rem;
        background: rgba(22, 163, 74, 0.1); color: var(--primary-strong);
        padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 700; margin-bottom: 0.5rem;
    }
    .pulse-dot { width: 8px; height: 8px; background: var(--primary-strong); border-radius: 50%; animation: pulse-green 2s infinite; }
    .welcome-title { font-size: 1.8rem; font-weight: 900; margin: 0 0 0.25rem 0; color: var(--text-main); }
    .welcome-subtitle { color: var(--text-sub); margin: 0; font-size: 1rem; }

    .stat-pill {
        background: #fff; padding: 0.75rem 1.25rem; border-radius: 12px;
        box-shadow: var(--shadow-card); display: flex; align-items: center; gap: 0.75rem; border: 1px solid var(--border-light);
    }
    .stat-icon { font-size: 1.5rem; }
    .stat-info { display: flex; flex-direction: column; line-height: 1.2; }
    .stat-label { font-size: 0.75rem; color: var(--text-sub); }
    .stat-value { font-weight: 800; font-size: 1.1rem; }

    /* Table Styles */
    .card-shadow {
        background: var(--card-bg); border-radius: var(--radius-card);
        box-shadow: var(--shadow-card); border: 1px solid var(--border-light); overflow: hidden;
    }
    .modern-table { width: 100%; border-collapse: collapse; }
    .modern-table th {
        background: #f8fafc; padding: 1rem 1.5rem; text-align: right;
        font-size: 0.85rem; color: var(--text-sub); font-weight: 600; border-bottom: 1px solid var(--border-light);
    }
    .modern-table td { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-light); vertical-align: middle; }
    .modern-table tr:hover { background: #fcfcfc; }

    .table-main-text { font-weight: 700; color: var(--text-main); font-size: 0.95rem; }
    .table-sub-text { font-size: 0.8rem; color: var(--text-sub); margin-top: 0.2rem; }
    .text-main { color: var(--text-main); }

    .amount-cell { font-weight: 800; color: var(--primary-strong); font-size: 1.1rem; }
    .amount-cell small { font-size: 0.8rem; color: var(--text-sub); font-weight: 600; }

    .ref-badge {
        display: inline-flex; align-items: center; gap: 0.5rem;
        background: #f1f5f9; padding: 0.4rem 0.8rem; border-radius: 8px;
        font-family: monospace; font-size: 0.9rem; color: var(--text-main); border: 1px solid var(--border-light);
    }
    .ref-icon { font-size: 1rem; }

    /* Actions */
    .actions-row { display: flex; gap: 0.5rem; align-items: center; }
    .d-inline { display: inline; }
    
    .btn-action {
        padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.85rem; font-weight: 700;
        cursor: pointer; border: none; transition: all 0.2s; text-decoration: none;
        display: inline-flex; align-items: center; gap: 0.4rem;
    }
    .btn-action.success { background: var(--primary-strong); color: white; }
    .btn-action.success:hover { background: #15803d; transform: translateY(-1px); }
    .btn-action.outline { background: transparent; border: 1px solid var(--border-light); color: var(--text-sub); }
    .btn-action.outline:hover { border-color: var(--primary-strong); color: var(--primary-strong); background: var(--primary-soft); }

    /* Empty State */
    .empty-state { text-align: center; padding: 4rem 2rem; }
    .empty-icon { font-size: 3rem; display: block; margin-bottom: 1rem; }
    .empty-content h3 { margin: 0 0 0.5rem; font-size: 1.2rem; }
    .empty-content p { color: var(--text-sub); margin: 0; }

    /* Animation */
    .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; opacity: 0; transform: translateY(20px); }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse-green {
        0% { box-shadow: 0 0 0 0 rgba(22, 163, 74, 0.7); }
        70% { box-shadow: 0 0 0 6px rgba(22, 163, 74, 0); }
        100% { box-shadow: 0 0 0 0 rgba(22, 163, 74, 0); }
    }
</style>
{% endblock %}
