{# finance/templates/finance/home.html #}
{% extends "base.html" %}
{% load humanize %}

{% block title %}Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©{% endblock %}

{% block content %}
<section class="page-section finance-dashboard">
  <div class="container">
    
    {# ===== Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© ===== #}
    <div class="section-header" style="text-align: right; margin-bottom: 2rem;">
      <div class="section-badge">
        ğŸ’° Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©
      </div>
      <h1 class="section-title">
        Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©
      </h1>
      <p class="section-description">
        Ù†Ø¸Ø±Ø© Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„ØªØ­ØµÙŠÙ„ ÙˆØ§Ù„Ø¶Ø±Ø§Ø¦Ø¨ ÙˆØ¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ù†ØµØ© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
      </p>
    </div>

    {# ===== Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ===== #}
    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
      
      {# Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° #}
      <div class="profile-section">
        <div class="card-section-title">ğŸ”„ Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</div>
        <div class="stat-value" style="font-size: 2rem; font-weight: 800; color: var(--primary-600); margin: 0.5rem 0;">
          {{ inprogress_count|default:0 }}
        </div>
        <div class="card-section-note">
          Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¨Ø§Ù„Øº Ø§ØªÙØ§Ù‚ÙŠØ§ØªÙ‡Ø§: {{ total_agreements_amount|floatformat:2 }} Ø±ÙŠØ§Ù„
        </div>
        <div class="employee-actions" style="margin-top: 1rem;">
          <a href="{% url 'finance:in_progress' %}" class="btn btn-outline btn-sm">
            Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
          </a>
        </div>
      </div>

      {# Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© #}
      <div class="profile-section" style="background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);">
        <div class="card-section-title">âœ… Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©</div>
        <div class="stat-value" style="font-size: 2rem; font-weight: 800; color: var(--primary-600); margin: 0.5rem 0;">
          {{ paid_sum|default:0|floatformat:2 }} Ø±ÙŠØ§Ù„
        </div>
        <div class="employee-actions" style="margin-top: 1rem;">
          <a href="{% url 'finance:invoice_list' %}?status=paid" class="btn btn-outline btn-sm">
            Ø¹Ø±Ø¶ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
          </a>
        </div>
      </div>

      {# Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© #}
      <div class="profile-section" style="background: linear-gradient(135deg, var(--secondary-50) 0%, var(--white) 100%);">
        <div class="card-section-title">â³ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©</div>
        <div class="stat-value" style="font-size: 2rem; font-weight: 800; color: var(--secondary-600); margin: 0.5rem 0;">
          {{ unpaid_sum|default:0|floatformat:2 }} Ø±ÙŠØ§Ù„
        </div>
        <div class="employee-actions" style="margin-top: 1rem;">
          <a href="{% url 'finance:invoice_list' %}?status=unpaid" class="btn btn-outline btn-sm">
            Ø¹Ø±Ø¶ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
          </a>
        </div>
      </div>


      {# Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº ÙÙ‚Ø· #}
      <div class="profile-section">
        <div class="card-section-title">ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</div>
        <div class="stat-value" style="font-size: 2rem; font-weight: 800; color: var(--primary-600); margin: 0.5rem 0;">
          {{ total_agreements_amount|default:0|floatformat:2 }} Ø±ÙŠØ§Ù„
        </div>
      </div>
    </div>

    {# ===== Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø³ÙÙ„ÙŠ ===== #}
    <div class="bottom-section" style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
      
      {# ØªØ­ÙˆÙŠÙ„Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ #}
      <div class="profile-section">
        <div class="card-header-row" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h2 class="card-section-title">ğŸ“¤ ØªØ­ÙˆÙŠÙ„Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÙƒÙŠØ¯ Ù…Ø§Ù„ÙŠ (Ù…Ø±Ø¬Ø¹ Ø¨Ù†ÙƒÙŠ Ù…ÙØ¯Ø®Ù„)</h2>
          <a href="{% url 'finance:confirm_transfers' %}" class="btn btn-outline btn-sm">
            ÙØªØ­ ØµÙØ­Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
          </a>
        </div>
        
        <div class="table-wrapper">
          <table class="table table-clean">
            <thead>
              <tr>
                <th>ÙØ§ØªÙˆØ±Ø©</th>
                <th>Ø·Ù„Ø¨</th>
                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                <th>Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„</th>
                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody>
              {% if pending_bank_confirms %}
                {% for inv in pending_bank_confirms %}
                  <tr class="scroll-reveal">
                    <td class="text-muted">#{{ inv.id }}</td>
                    <td>R{{ inv.agreement.request_id }}</td>
                    <td>
                      <span class="value-strong">{{ inv.total_amount|floatformat:2 }} Ø±ÙŠØ§Ù„</span>
                    </td>
                    <td>
                      <span class="badge badge-default">{{ inv.paid_ref|default:"â€”" }}</span>
                    </td>
                    <td>
                      <a href="{% url 'finance:invoice_detail' inv.id %}" class="btn btn-outline btn-sm">
                        ØªÙØ§ØµÙŠÙ„
                      </a>
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="5" class="text-center text-muted" style="padding: 2rem;">
                    <div class="text-4xl mb-2 opacity-40">ğŸ’¸</div>
                    Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­ÙˆÙŠÙ„Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø­Ø§Ù„ÙŠÙ‹Ø§
                  </td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>

      {# Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª #}
      <div class="profile-section">
        <div class="card-section-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ù‘ÙØ³ÙØ¨</div>
        <p class="card-section-note" style="margin-bottom: 1rem;">
          Ù†Ø³Ø¨Ø© Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ù†ØµØ© Ùˆ VAT (Ø¨ÙŠÙ† 0 Ùˆ 1)
        </p>
        
        <div class="employee-actions" style="margin-bottom: 2rem;">
          {% if settings_url %}
            <a href="{{ settings_url }}" class="btn btn-primary btn-sm" style="width: 100%;">
              ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </a>
          {% else %}
            <a href="{% url 'finance:settings' %}" class="btn btn-primary btn-sm" style="width: 100%;">
              ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </a>
          {% endif %}
        </div>


        {# Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµØ§ÙÙŠ Ù…ÙˆØ¸ÙÙŠÙ† - ÙÙ‚Ø· Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯Ø®Ù„ #}
      </div>
    </div>

    {# ===== Ù…ÙˆØ¬Ø² Ø³Ø±ÙŠØ¹ ===== #}
    <div class="profile-section" style="margin-top: 2rem; background: var(--dark-50);">
      <div class="card-section-title">ğŸ“Š Ù…ÙˆØ¬Ø² Ø³Ø±ÙŠØ¹</div>
      <div class="quick-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div class="stat-item">
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©</div>
          <div class="stat-number">{{ paid_sum|default:0|floatformat:2 }} Ø±ÙŠØ§Ù„</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©</div>
          <div class="stat-number">{{ unpaid_sum|default:0|floatformat:2 }} Ø±ÙŠØ§Ù„</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ù†ØµØ©</div>
          <div class="stat-number">{{ platform_fee_total|default:0|floatformat:2 }} Ø±ÙŠØ§Ù„</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© VAT</div>
          <div class="stat-number">{{ vat_total|default:0|floatformat:2 }} Ø±ÙŠØ§Ù„</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ØµØ§ÙÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø¯ÙÙˆØ¹</div>
          <div class="stat-number">{{ employee_dues_total|default:0|floatformat:2 }} Ø±ÙŠØ§Ù„</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ØµØ§ÙÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù‚ (Ù†Ø²Ø§Ø¹)</div>
          <div class="stat-number">{{ disputed_total|default:0|floatformat:2 }} Ø±ÙŠØ§Ù„</div>
        </div>
      </div>
    </div>

  </div>
</section>
{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script>
  (function () {
    // ØªÙ‡ÙŠØ¦Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ±
    if (typeof initScrollReveal === 'function') {
      initScrollReveal();
    }

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©
    document.querySelectorAll('.profile-section').forEach((card, index) => {
      card.style.animationDelay = `${index * 0.1}s`;
      card.classList.add('scroll-reveal');
      
      // ØªØ£Ø«ÙŠØ± hover Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©
      card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-5px)';
        this.style.boxShadow = 'var(--shadow-lg)';
      });
      
      card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '';
      });
    });

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.querySelectorAll('.btn').forEach(button => {
      button.addEventListener('click', function() {
        if (typeof animateButtonClick === 'function') {
          animateButtonClick(this);
        }
      });
    });

    // ØªØ­Ø¯ÙŠØ« Ø­ÙŠÙˆÙŠ Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§)
    function updateStats() {
      const statValues = document.querySelectorAll('.stat-value');
      statValues.forEach(stat => {
        const originalValue = stat.textContent;
        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø±Ù‚Ù…ÙŠØ© Ù…ØªØ­Ø±ÙƒØ© Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§
      });
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    updateStats();

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    document.querySelectorAll('.table-clean tbody tr').forEach(row => {
      row.addEventListener('mouseenter', function() {
        this.style.background = 'var(--primary-50)';
      });
      
      row.addEventListener('mouseleave', function() {
        this.style.background = '';
      });
    });

    // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ÙˆØ­Ø© (ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§)
    /*
    setInterval(() => {
      // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§
      console.log('Updating finance dashboard...');
    }, 30000); // ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
    */

  })();
  </script>

  <style>
  .finance-dashboard .stats-grid {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  }

  .finance-dashboard .profile-section {
    transition: all 0.3s ease;
    min-height: 140px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .finance-dashboard .table-wrapper {
    overflow-x: auto;
    border-radius: var(--radius-lg);
    border: 1px solid var(--dark-200);
  }

  .finance-dashboard .table-clean {
    width: 100%;
    border-collapse: collapse;
  }

  .finance-dashboard .table-clean th {
    background: var(--dark-50);
    color: var(--dark-700);
    font-weight: 600;
    padding: 1rem;
    text-align: right;
    border-bottom: 1px solid var(--dark-200);
  }

  .finance-dashboard .table-clean td {
    padding: 1rem;
    border-bottom: 1px solid var(--dark-100);
    vertical-align: middle;
  }

  .finance-dashboard .table-clean tr:last-child td {
    border-bottom: none;
  }

  .finance-dashboard .value-strong {
    font-weight: 700;
    color: var(--dark-900);
  }

  .finance-dashboard .text-muted {
    color: var(--dark-500);
  }

  .finance-dashboard .text-center {
    text-align: center;
  }

  .finance-dashboard .quick-stats {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }

  .finance-dashboard .stat-item {
    text-align: center;
    padding: 1rem;
    background: var(--white);
    border-radius: var(--radius-lg);
    border: 1px solid var(--dark-200);
      {# Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·: Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯Ø®Ù„Ø© #}
      <div class="profile-section" style="max-width: 500px; margin: 0 auto 2rem auto; background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);">
        <div class="card-section-title" style="font-size: 1.3rem;">ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</div>
        <div class="stat-value" style="font-size: 2.5rem; font-weight: 900; color: var(--primary-700); margin: 1.5rem 0; letter-spacing:1px;">
          {{ total_agreements_amount|default:0|floatformat:2 }} <span style="font-size:1.1rem; color:#bfa700;">Ø±ÙŠØ§Ù„</span>
        </div>
        <div class="card-section-note" style="font-size:1.1rem; color:var(--dark-500); margin-bottom:1.5rem;">
          Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ÙŠØ¹ÙƒØ³ ÙÙ‚Ø· Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯Ø®Ù„Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø§ØªÙØ§Ù‚ÙŠØ§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©.
        </div>
      </div>

  .finance-dashboard .stat-number {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary-600);
  }

  @media (max-width: 1024px) {
    .finance-dashboard .bottom-section {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .finance-dashboard .stats-grid {
      grid-template-columns: 1fr;
    }
    
    .finance-dashboard .quick-stats {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .finance-dashboard .table-wrapper {
      font-size: 0.875rem;
    }
  }

  @media (max-width: 480px) {
    .finance-dashboard .quick-stats {
      grid-template-columns: 1fr;
    }
    
    .finance-dashboard .stat-item {
      padding: 0.75rem;
    }
  }

  /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
  @keyframes countUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .finance-dashboard .stat-value {
    animation: countUp 0.6s ease-out;
  }
  </style>
{% endblock %}